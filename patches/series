#
# XenServer patch queue on top of xen.git
#    Upstream at git://xenbits.xen.org/xen.git
#
# In an effort to reduce future work of upgrading Xen versions, all patches in
# this queue require a justification as to why they can't/won't be upstreamed,
# with the implication that everything else should be upstreamed.
#
# If in any doubt, the ring0 patch queue maintainer will be happy to help.
#
# All patches should follow the guidelines listed here:
#       http://wiki.xen.org/wiki/Submitting_Xen_Patches
# in particular with respect to a description and S-o-b lines, with the
# exception of temporary debugging patches, which should contain at least a CA
# reference.
#
# Overview of sections:
# * XenServer build system integration.
#       **Minimal Upstream makefile hacks**
# * Upstream patches.
#       Verbatim patches from upstream, possibly with tweaks because of backporting
# * Patches for upstream.
#       Most patches should be in this section, especially new ones.  By using
#       this section, you are assuming responsibility for getting the patches
#       included upstream, and will be periodically chased by the patch queue
#       maintainer.
# * Un-upstreamable patches.
#       Default tweaks, etc.  Should be minimal.
# * Technical debt.
#       Legacy patches brought forward from the past.  This section should
#       never increase, and should progressively decrease.  **Remove when empty**
# * Debugging patches.
#       Temporary debugging patches, which must contain a CA reference.  Before
#       closing a ticket, you are expected to remove debugging patches.

################################################################################
# XenServer build system integration
#
build-tweaks.patch # Tweak version string, start-of-day banner and changeset
autoconf-libjson.patch

configure-build.patch # Configuration files for the build, including cached ./configure
xenserver-configuration.patch
coverity-model.patch

################################################################################
# Upstream patches
#
# Naming scheme: backport-<12 digit SHA>.patch # [*] <UTC TIMESTAMP> - <Commit subject>
#   A '*' indicates a patch which should be suggested for backport upstream

# Patches from staging-4.13
backport-b4bb02d5999a.patch #   2021-10-05 19:49:12 - VT-d: fix deassign of device with RMRR
backport-d94d006ed360.patch #   2021-11-23 12:32:54 - x86/PoD: deal with misaligned GFNs
backport-d3cfb4b3a680.patch #   2021-11-23 12:33:14 - x86/PoD: handle intermediate page orders in p2m_pod_cache_add()
backport-d3c2319ea165.patch #   2021-11-23 12:33:33 - x86/P2M: deal with partial success of p2m_set_entry()
backport-e48c7878e54a.patch #   2022-01-25 13:44:47 - xen/grant-table: Only decrement the refcounter when grant is fully unmapped
backport-ce49a1d6d819.patch #   2022-01-25 13:45:07 - passthrough/x86: stop pirq iteration immediately in case of error
backport-7b9814b250a5.patch #   2022-03-08 17:13:41 - x86/spec-ctrl: Cease using thunk=lfence on AMD
backport-8ed46cc1ef14.patch #   2022-04-05 14:19:40 - VT-d: split domid map cleanup check into a function
backport-2ce2aec8c148.patch #   2022-04-05 14:20:10 - x86/hap: do not switch on log dirty for VRAM tracking
backport-920e93df4e16.patch #   2022-04-05 14:20:42 - VT-d: correct ordering of operations in cleanup_domid_map()
backport-650b888c8a0a.patch #   2022-04-05 14:21:21 - VT-d: fix (de)assign ordering when RMRRs are in use
backport-81918cead1a5.patch #   2022-04-05 14:22:31 - VT-d: fix add/remove ordering when RMRRs are in use
backport-33c13654cb6d.patch #   2022-04-05 14:23:26 - VT-d: drop ownership checking from domain_context_mapping_one()
backport-235aa158e0f7.patch #   2022-04-05 14:23:57 - VT-d: re-assign devices directly
backport-73e25ecaef14.patch #   2022-04-05 14:24:23 - AMD/IOMMU: re-assign devices directly
backport-92acf6b23154.patch #   2022-04-05 14:24:54 - VT-d: prepare for per-device quarantine page tables (part I)
backport-ab37463eec57.patch #   2022-04-05 14:25:26 - VT-d: prepare for per-device quarantine page tables (part II)
backport-7cfe3570b1c0.patch #   2022-04-05 14:25:54 - IOMMU/x86: maintain a per-device pseudo domain ID
backport-e6d6b5ba030a.patch #   2022-04-05 14:26:41 - IOMMU/x86: drop TLB flushes from quarantine_init() hooks
backport-454d5351a93d.patch #   2022-04-05 14:27:09 - AMD/IOMMU: abstract maximum number of page table levels
backport-169a2834ef5d.patch #   2022-04-05 14:27:36 - IOMMU/x86: use per-device page tables for quarantining
backport-a6902a65160a.patch #   2022-04-08 14:20:21 - VT-d: don't needlessly look up DID
backport-d64d46685c77.patch #   2022-04-08 14:21:33 - VT-d: avoid NULL deref on domain_context_mapping_one() error paths
backport-fe97133b5dee.patch #   2022-04-08 14:22:49 - VT-d: avoid infinite recursion on domain_context_mapping_one() error path
backport-3826ba5f8271.patch #   2022-06-09 16:13:30 - x86/pv: Clean up _get_page_type()
backport-7669737d7da5.patch #   2022-06-09 16:13:54 - x86/pv: Fix ABAC cmpxchg() race in _get_page_type()
backport-c7da430b21e0.patch #   2022-06-09 16:14:12 - x86/page: Introduce _PAGE_* constants for memory types
backport-fce392fa36c3.patch #   2022-06-09 16:14:39 - x86: Don't change the cacheability of the directmap
backport-8d9f36132afd.patch #   2022-06-09 16:15:11 - x86: Split cache_flush() out of cache_writeback()
backport-e8c04e468312.patch #   2022-06-09 16:15:39 - x86/amd: Work around CLFLUSH ordering on older parts
backport-f9ae12fc103c.patch #   2022-06-09 16:16:06 - x86/pv: Track and flush non-coherent mappings of RAM
backport-c2095ac76be0.patch #   2022-06-10 09:21:06 - x86/mm: account for PGT_pae_xen_l2 in recently added assertion
backport-a84bc5bde583.patch #   2022-06-16 13:40:24 - x86/spec-ctrl: Make VERW flushing runtime conditional
backport-413b08328a57.patch #   2022-06-16 13:40:24 - x86/spec-ctrl: Enumeration for MMIO Stale Data controls
backport-87ff11354f0d.patch #   2022-06-16 13:40:24 - x86/spec-ctrl: Add spec-ctrl=unpriv-mmio
backport-14c5e0c13422.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Honour spec-ctrl=0 for unpriv-mmio sub-option
backport-8a2cc1ed1aee.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Drop SPEC_CTRL_{ENTRY_FROM,EXIT_TO}_HVM
backport-f614e3c51ae0.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Split the "Hardware features" diagnostic line
backport-4eddf132b5e0.patch #   2022-07-12 16:33:19 - x86/amd: Enumeration for speculative features/hints
backport-d43b47eb6a26.patch #   2022-07-12 16:33:19 - x86/amd: Use newer SSBD mechanisms if they exist
backport-55e4c720b269.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Print all AMD speculative hints/features
backport-8974821f13ad.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Drop use_spec_ctrl boolean
backport-bf5f5e89f040.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Introduce new has_spec_ctrl boolean
backport-074e388fe0df.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Don't use spec_ctrl_{enter,exit}_idle() for S3
backport-b8d573a31beb.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Use common MSR_SPEC_CTRL logic for AMD
backport-159e2235d75b.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Only adjust MSR_SPEC_CTRL for idle with legacy IBRS
backport-a7e72872e99b.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Knobs for STIBP and PSFD, and follow hardware STIBP hint
backport-4b42462701f0.patch #   2022-07-12 16:33:19 - xen/cmdline: Extend parse_boolean() to signal a name match
backport-10d8c56e93a0.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Add fine-grained cmdline suboptions for primitives
backport-196b4f4d34d4.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Rework spec_ctrl_flags context switching
backport-ba3367292342.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Rename SCF_ist_wrmsr to SCF_ist_sc_msr
backport-fbf19baaaf5c.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Rename opt_ibpb to opt_ibpb_ctxt_switch
backport-5994b739453f.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Rework SPEC_CTRL_ENTRY_FROM_INTR_IST
backport-ebe3f5d90924.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Support IBPB-on-entry
backport-3c71016e68f2.patch #   2022-07-12 16:33:19 - x86/cpuid: Enumeration for BTC_NO
backport-3feba68e15d3.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Enable Zen2 chickenbit
backport-f8614c7153f9.patch #   2022-07-12 16:33:19 - x86/spec-ctrl: Mitigate Branch Type Confusion when possible
backport-c946524a65f3.patch #   2022-07-26 14:05:08 - x86/mm: correct TLB flush condition in _get_page_type()

# Patches from master
backport-680d18763aef.patch #   2019-11-29 18:57:32 - AMD/IOMMU: Render IO_PAGE_FAULT errors in a more useful manner
backport-cd7dedad8209.patch #   2019-11-29 19:18:31 - passthrough: simplify locking and logging
backport-79cf0989175c.patch #   2019-12-05 12:31:03 - passthrough: drop break statement following c/s cd7dedad820
backport-6dd95b02ea27.patch #   2019-12-16 16:04:10 - x86/time: drop vtsc_{kern, user}count debug counters
backport-0cd791c499bd.patch #   2019-12-19 18:48:00 - tools/python: Drop test.py
backport-9356f9de4162.patch #   2019-12-20 15:26:09 - x86/ioapic: only use dest32 with x2apic and interrupt remapping enabled
backport-c08cbf7fb891.patch #   2019-12-20 15:27:48 - x86/apic: force phys mode if interrupt remapping is disabled
backport-3d05407025ed.patch #   2019-12-20 15:28:27 - x86/smp: check APIC ID on AP bringup
backport-b1710040ca96.patch #   2019-12-20 15:29:22 - x86/apic: allow enabling x2APIC mode regardless of interrupt remapping
backport-31bf4f26aa17.patch #   2019-12-20 16:08:00 - tools/libxc: Drop other examples of the 'goto x; } else if' antipattern
backport-e9bd648015dd.patch #   2019-12-24 14:59:04 - libxc/restore: Don't duplicate state in process_vcpu_basic()
backport-da9290639eb5.patch #   2019-12-26 15:57:04 - x86/vvmx: virtualize x2APIC mode and APIC accesses can't both be enabled
backport-7b3c5b70a323.patch #   2020-01-03 18:37:25 - tools/libxc: disable x2APIC when using nested virtualization
backport-1171a93b6ca7.patch #   2020-01-03 18:37:25 - tools/restore: Drop unused parameters from xc_domain_restore()
backport-2004db3ced18.patch #   2020-01-07 12:26:45 - tools/save: Drop unused parameters from xc_domain_save()
backport-59e1f6d89710.patch #   2020-01-15 15:22:28 - libxc/restore: Introduce functionality to simplify blob handling
backport-86cf92f50533.patch #   2020-01-15 15:22:28 - libxc/migration: Rationalise the 'checkpointed' field to 'stream_type'
backport-0a9c44486b90.patch #   2020-02-10 10:58:07 - tools/python: Drop cpuid helpers
backport-270ff9a835fb.patch #   2020-02-10 13:09:54 - tools/ocaml: Drop cpuid helpers
backport-dacb80f9757c.patch #   2020-02-11 18:26:52 - tools/libxl: Remove libxl_cpuid_{set,apply_policy}() from the API
backport-1b3cec69bf30.patch #   2020-02-11 18:26:52 - tools/libxl: Combine legacy CPUID handling logic
backport-8171e0796542.patch #   2020-02-17 19:10:55 - tools/libx[cl]: Don't use HVM_PARAM_PAE_ENABLED as a function parameter
backport-9649cef3b3a7.patch #   2020-02-28 15:25:43 - AMD/IOMMU: correct handling when XT's prereq features are unavailable
backport-a798bac54fe8.patch #   2020-03-06 09:18:13 - x86/hvm: allow ASID flush when v != current
backport-920d5f31883c.patch #   2020-03-10 14:29:24 - x86/paging: add TLB flush hook
backport-c9495bd7dff5.patch #   2020-03-10 14:30:27 - x86/hap: improve hypervisor assisted guest TLB flush
backport-53ddfc80a84a.patch #   2020-03-11 12:17:41 - rcu: use rcu softirq for forcing quiescent state
backport-a9b6dacf88fe.patch #   2020-03-11 12:18:49 - rcu: fix rcu_lock_domain()
backport-7ff66809ccd5.patch #   2020-03-26 11:39:08 - x86emul: support AVX512_BF16 insns
backport-53594c7bd197.patch #   2020-03-26 11:43:23 - rcu: don't use stop_machine_run() for rcu_barrier()
backport-540d4d60378c.patch #   2020-03-26 11:49:42 - cpu: sync any remaining RCU callbacks before CPU up/down
backport-3174835ba825.patch #   2020-04-29 08:04:40 - x86/tlb: introduce a flush HVM ASIDs flag
backport-c2b4e23fdda4.patch #   2020-04-29 08:07:32 - x86/tlb: allow disabling the TLB clock
backport-e9aca9470ed8.patch #   2020-04-29 08:10:19 - x86/tlb: use Xen L0 assisted TLB flush when available
backport-68d757df8dd2.patch #   2020-04-29 21:13:00 - x86/pv: Options to disable and/or compile out 32bit PV support
backport-17b997aa1edb.patch #   2020-05-04 10:53:01 - x86/hap: be more selective with assisted TLB flush
backport-35b819c45c46.patch #   2020-05-07 18:58:04 - sched: print information about scheduling granularity
backport-d8a6a8b36d86.patch #   2020-05-13 20:33:42 - tools/libxc: Reduce feature handling complexity in xc_cpuid_apply_policy()
backport-54463aa79dac.patch #   2020-06-17 13:54:12 - x86/hvm: Disable MPX by default
backport-4489ffdec331.patch #   2020-07-28 19:33:28 - x86/hvm: fix vIO-APIC build without IRQ0_SPECIAL_ROUTING
backport-ab5bfc049e8e.patch #   2020-07-28 19:33:28 - x86/hvm: don't force vCPU 0 for IRQ 0 when using fixed destination mode
backport-dc036ab9d506.patch #   2020-07-28 19:33:28 - x86/hvm: fix ISA IRQ 0 handling when set as lowest priority mode in IO APIC
backport-b9e9ccbb11e4.patch #   2020-07-28 19:33:28 - x86/vpt: only try to resume timers belonging to enabled devices
backport-b6641f28c593.patch #   2020-07-28 19:33:28 - x86/hvm: only translate ISA interrupts to GSIs in virtual timers
backport-a85f67b2658e.patch #   2020-07-31 15:18:41 - tools/configure: drop BASH configure variable
backport-758fae24d7b9.patch #   2020-11-25 13:06:27 - xen/include: import sizeof_field() macro from Linux stddef.h
backport-e373bc1bdc59.patch #   2020-12-07 13:49:30 - x86/IRQ: make max number of guests for a shared IRQ configurable
backport-b7c333016e3d.patch #   2020-12-07 13:52:35 - x86/IRQ: allocate guest array of max size only for shareable IRQs
backport-7e5cffcd1e93.patch #   2021-01-29 13:18:43 - viridian: allow vCPU hotplug for Windows VMs
backport-5d752df85f2c.patch #   2021-01-29 16:55:23 - xen/dm: Introduce xendevicemodel_set_irq_level DM op
backport-e8af54084586.patch #   2021-02-04 21:26:41 - libs/devicemodel: Fix ABI breakage from xendevicemodel_set_irq_level()
backport-81b2b328a26c.patch #   2021-02-24 11:48:13 - hvmloader: use Xen private header for elf structs
backport-60390ccb8b9b.patch #   2021-02-24 15:31:12 - elfstructs: add relocation defines for i386
backport-c4441ab1f1d5.patch #   2021-02-26 12:28:52 - dmop: Add XEN_DMOP_nr_vcpus
backport-570da5423dbe.patch #   2021-03-01 23:19:39 - tools/hvmloader: Drop machelf include as well
backport-0eae016b6e3d.patch #   2021-03-01 23:19:39 - tools/firmware: Build firmware as -ffreestanding
backport-6b0ac9a4e239.patch #   2021-03-04 15:54:25 - xen/dmop: Fix XEN_DMOP_nr_vcpus to actually return data
backport-f40e1c52e4e0.patch #   2021-03-04 15:54:25 - tools/libxendevicemodel: Strip __XEN_TOOLS__ header guard
backport-368096b9c4a2.patch #   2021-03-11 17:27:48 - xen/dmop: Strip __XEN_TOOLS__ header guard from public ABI
backport-e21a6a4f966a.patch #   2021-04-09 10:31:17 - tools: Drop gettext as a build dependency
backport-935d501ccbf5.patch #   2021-04-09 10:31:17 - xen/xsm: Improve alloc/free of evtchn buckets
backport-fb23e8ba2304.patch #   2021-04-26 09:21:09 - x86/vPMU: Extend vPMU support to version 5
backport-08693c03e00e.patch #   2021-04-26 09:22:04 - x86/vtx: add LBR_SELECT to the list of LBR MSRs
backport-95419adfd4b2.patch #   2021-04-26 09:22:48 - x86/intel: insert Ice Lake-SP and Ice Lake-D model numbers
backport-f17d848c4caa-fix.patch #                   - x86/cpuid: Fix "x86/cpuid: Rework HLE and RTM handling" backport
backport-3670abcaf032.patch #   2021-05-27 19:34:00 - x86/tsx: Minor cleanup and improvements
backport-9fdcf851689c.patch #   2021-05-27 19:34:00 - x86/tsx: Deprecate vpmu=rtm-abort and use tsx=<bool> instead
backport-2d1a35f1e6c2.patch #   2021-06-08 15:35:00 - tools/ocaml: Fix redefinition errors
backport-3e09045991cd.patch #   2021-06-09 14:17:58 - x86/tsx: Cope with TSX deprecation on SKL/KBL/CFL/WHL
backport-b672695e7488.patch #   2021-06-15 20:50:32 - x86/msr: Expose MSR_ARCH_CAPS in the raw and host policies
backport-79ca512a1fa6.patch #   2021-07-09 16:38:27 - tools/tests: Drop obsolete mce-test infrastructure
backport-6a9f5477637a.patch #   2021-07-09 16:38:27 - tests/cpu-policy: Rework Makefile
backport-93c9edbef51b.patch #   2021-07-09 16:38:27 - tests/xenstore: Rework Makefile
backport-73c932d0ea43.patch #   2021-07-26 10:32:04 - tools/libxc: use uint32_t for pirq in xc_domain_irq_permission
backport-1787cc167906.patch #   2021-08-19 18:34:53 - libs/guest: Move the guest ABI check earlier into xc_dom_parse_image()
backport-afab477fba3b.patch #   2021-08-27 14:19:02 - x86/spec-ctrl: Skip RSB overwriting when safe to do so
backport-c76cfada1cfa.patch #   2021-09-10 13:27:08 - tools/libacpi: Use 64-byte alignment for FACS
backport-f26bb285949b.patch #   2021-09-10 20:30:26 - xen: Implement xen/alternative-call.h for use in common code
backport-4624912c0b55.patch #   2021-09-10 20:30:26 - xsm: remove the ability to disable flask
backport-2928c1d250b1.patch #   2021-09-10 20:30:26 - xsm: remove remnants of xsm_memtype hook
backport-6d45368a0a89.patch #   2021-09-10 20:30:26 - xsm: drop dubious xsm_op_t type
backport-b17546d7f33e.patch #   2021-09-16 09:58:59 - xsm: apply coding style
backport-164a0b9653f4.patch #   2021-09-16 09:59:40 - xsm: refactor xsm_ops handling
backport-737190abb174.patch #   2021-09-16 10:00:17 - xsm: convert xsm_ops hook calls to alternative call
backport-e083d753924b.patch #   2021-09-21 19:41:12 - x86/hvm: Reduce stack usage from HVMTRACE_ND()
backport-91bac8ad7c06.patch #   2021-09-21 19:41:12 - x86/hvm: Remove duplicate calls caused by tracing
backport-dd6c062a7a4a.patch #   2021-09-24 11:07:50 - tools/libxl: Correctly align the ACPI tables
backport-9c3b9800e201.patch #   2021-09-28 15:04:50 - pci: fix handling of PCI bridges with subordinate bus number 0xff
backport-b11380f6cd58.patch #   2021-10-08 18:52:22 - x86/spec-ctrl: Build with BRANCH_HARDEN lfences by default
backport-b6b672e8a925.patch #   2021-10-11 09:58:44 - x86/HVM: fix xsm_op for 32-bit guests
backport-834cb8761051.patch #   2021-10-12 10:55:42 - x86/PV32: fix physdev_op_compat handling
backport-eb7518b89be6.patch #   2021-10-12 16:56:11 - x86/pv: Split pv_hypercall() in two
backport-31f3bc97f450.patch #   2022-01-05 09:44:26 - x86/spec-ctrl: Fix default calculation of opt_srb_lock
backport-b07050e1e8f7.patch #   2022-01-19 12:45:11 - x86/mwait-idle: update ICX C6 data
backport-88d3ff7ab15d.patch #   2022-01-20 16:32:11 - x86/guest: Introduce {get,set}_reg() infrastructure
backport-6536688439db.patch #   2022-01-20 16:32:11 - x86/msr: Split MSR_SPEC_CTRL handling
backport-81f0eaadf84d.patch #   2022-01-20 16:32:11 - x86/spec-ctrl: Fix NMI race condition with VT-x MSR_SPEC_CTRL handling
backport-e3662437eb43.patch #   2022-01-27 17:38:15 - x86/cpuid: Disentangle logic for new feature leaves
x86-cpuid-Infrastructure-for-leaf-0x80000021.eax.patch
backport-e1828e3032eb.patch #   2022-01-27 17:38:15 - x86/cpuid: Infrastructure for leaf 7:1.ebx
backport-969a57f73f6b.patch #   2022-01-27 17:59:18 - x86/msr: Fix migration compatibility issue with MSR_SPEC_CTRL
backport-15b7611efd49.patch #   2022-02-01 13:20:44 - x86/cpuid: Advertise SSB_NO to guests by default
backport-00f2992b6c7a.patch #   2022-02-01 13:20:44 - x86/spec-ctrl: Record the last write to MSR_SPEC_CTRL
backport-614cec7d79d7.patch #   2022-02-01 13:20:44 - x86/svm: VMEntry/Exit logic for MSR_SPEC_CTRL
backport-22b9add22b4a.patch #   2022-02-01 13:20:44 - x86/msr: AMD MSR_SPEC_CTRL infrastructure
backport-a7e7c7260cde.patch #   2022-02-01 13:20:44 - x86/cpuid: Enable MSR_SPEC_CTRL in SVM guests by default
backport-f97c1abf2934.patch #   2022-02-07 17:41:24 - xen/smp: Speed up on_selected_cpus()
backport-39a40f3835ef.patch #   2022-02-08 18:00:08 - x86/spec-ctrl: Clean up MSR_MCU_OPT_CTRL handling
backport-4116139131e9.patch #   2022-02-08 18:00:08 - x86/tsx: Move has_rtm_always_abort to an outer scope
backport-ad9f7c3b2e0d.patch #   2022-02-08 18:00:08 - x86/tsx: Cope with TSX deprecation on WHL-R/CFL-R
backport-f3709b15fc86.patch #   2022-02-08 18:00:08 - x86/cpuid: Infrastructure for cpuid word 7:2.edx
backport-52ce1c97844d.patch #   2022-02-08 18:00:08 - x86/spec-ctrl: Support Intel PSFD for guests
backport-81d195c6c0e2.patch #   2022-02-18 13:42:39 - x86: introduce ioremap_wc()
backport-f627a39c5e75.patch #   2022-02-18 13:44:32 - video/vesa: unmap frame buffer when relinquishing console
backport-6ba701064227.patch #   2022-02-18 13:45:14 - video/vesa: drop "vesa-mtrr" command line option
backport-7f7e55b85fce.patch #   2022-02-18 13:45:45 - video/vesa: drop "vesa-remap" command line option
backport-ea140035d01a.patch #   2022-02-18 13:46:27 - video/vesa: adjust (not just) command line option handling
backport-e270af94280e.patch #   2022-04-04 11:30:07 - tools/firmware: do not add a .note.gnu.property section
backport-60d1adfa1879.patch #   2022-06-30 18:07:13 - x86/ept: fix shattering of special pages
backport-e570e8d520ab.patch #   2022-08-05 12:16:24 - x86/spec-ctrl: Use IST RSB protection for !SVM systems
backport-31b41ce858c8.patch #   2022-08-11 16:44:26 - x86/amd: only call setup_force_cpu_cap for boot CPU
backport-0f2611c52438.patch #   2022-08-17 12:50:48 - x86/traps: Make nmi_show_execution_state() more useful
backport-c3bd0b83ea5b.patch #   2022-08-24 13:23:59 - x86/CPUID: surface suitable value in EBX of XSTATE subleaf 1

################################################################################
# Patches for upstream
#

0001-x86-AMD-make-HT-range-dynamic-for-Fam17-and-up.patch
0001-tools-Fix-pkg-config-file-for-libxenstore.patch

# vPIT servies v1
0006-x86-vpt-fix-injection-to-remote-vCPU.patch

# late ucode loading fixes/changes
0003-xen-microcode-add-information-about-currently-loaded.patch
0004-microcode-add-sequential-application-policy.patch
0007-microcode-update-raw-cpuid-policy-after-a-successful.patch
0001-microcode-remove-panic-calls.patch

detect-nehalem-c-state.patch # malcolmc
quirk-hp-gen8-rmrr.patch # malcolmc
quirk-pci-phantom-function-devices.patch # malcolmc

# Hpet improvements v5
0001-x86-hpet-Pre-cleanup.patch
0002-x86-hpet-Use-singe-apic-vector-rather-than-irq_descs.patch
0003-x86-hpet-Post-cleanup.patch

0002-libxc-retry-shadow-ops-if-EBUSY-is-returned.patch

# Grant perf improvements
avoid-gnt-unmap-tlb-flush-if-not-accessed.patch

# Further MB2/EFI fixes
0002-efi-Ensure-incorrectly-typed-runtime-services-get-ma.patch
0001-x86-time-Don-t-use-EFI-s-GetTime-call.patch
0001-efi-Workaround-page-fault-during-runtime-service.patch

0001-x86-HVM-Avoid-cache-flush-operations-during-hvm_load.patch # rossla - CA-168080
0001-libxl-Don-t-insert-PCI-device-into-xenstore-for-HVM-.patch # rossla - CA-168029

# PoD extra mitigations
0001-x86-PoD-Command-line-option-to-prohibit-any-PoD-oper.patch

livepatch-ignore-duplicate-new.patch
default-log-level-info.patch

# Reduce use of __LINE__
0001-lib-Add-a-generic-implementation-of-current_text_add.patch
0002-sched-Remove-dependency-on-__LINE__-for-release-buil.patch

# btrfs support for PV guests
pygrub-Ignore-GRUB2-if-statements.patch
libfsimage-Add-support-for-btrfs.patch

quiet-broke-irq-affinity.patch # rossla

# MSR policy
0001-x86-msr-Blacklist-various-MSRs-which-guests-definite.patch

# AVX-512
0001-Hide-AVX-512-from-guests-by-default.patch

# memory scrubbing
0001-common-page_alloc-don-t-idle-scrub-before-microcode-.patch

0001-xsm-hide-detailed-Xen-version-from-unprivileged-gues.patch

################################################################################
# Un-upstreamable patches
#
xen-tweak-cmdline-defaults.patch
xen-tweak-debug-overhead.patch
tweak-iommu-policy.patch
tweak-sc-policy.patch
disable-core-parking.patch

0001-Allocate-space-in-structs-pre-emptively-to-increase-.patch

0001-x86-mm-partially-revert-37201c62-make-logdirty-and-i.patch

# This will need to use Flask, when Flask is suitably ready
hitachi-driver-domain-ssid.patch

################################################################################
# Technical debt
#

# xen debt
livepatch-payload-in-header.patch
xen-define-offsets-for-kdump.patch
xen-scheduler-auto-privdom-weight.patch
xen-hvm-disable-tsc-ramping.patch
xen-default-cpufreq-governor-to-performance-on-intel.patch
0001-Partially-revert-08754333892-hvmloader-limit-CPUs-ex.patch
0001-x86-pv-silently-discard-writes-into-MSR_AMD64_LS_CFG.patch # Remove when SSBD handling on AMD is reworked
i8259-timers-pick-online-vcpu.patch

# libxc debt
revert-ca2eee92df44.patch # 2008-09-30 09:14:54 - x86, hvm: Expose host core/HT topology to HVM guests - needs removing in a migrate-safe way.
libxc-stubs-hvm_check_pvdriver.patch
libxc-cpuid-cores_per_socket.patch

# pygrub debt
pygrub-add-default-and-extra-args.patch
pygrub-always-boot-default.patch
pygrub-friendly-no-fs.patch
pygrub-image-max-size.patch
pygrub-default-xenmobile-kernel.patch
pygrub-blacklist-support.patch

# BIOS debt
oem-bios-xensource.patch # Can probably all be discarded
oem-bios-magic-from-xenstore.patch # Need to tweak, but should be upstreamed

# misc debt
misc-log-guest-consoles.patch
fix-ocaml-libs.patch
retrofit-max-featuresets.patch

# xentop debt
xentop-vbd3.patch

# mixed between components
mixed-domain-runstates.patch
xenguest.patch
xen-vmdebug.patch

oxenstore-censor-sensitive-data.patch
oxenstore-large-packets.patch
0019-tools-xenstore-add-live-update-command-to-xenstore-c.patch
0001-tools-ocaml-xenstored-only-quit-on-SIGTERM-when-a-re.patch
0002-tools-ocaml-xenstored-Automatically-resume-when-poss.patch
0003-tools-ocaml-xenstored-add-cooperative-live-update-co.patch
0004-tools-ocaml-xenstored-start-live-update-process.patch
0006-tools-ocaml-xenstored-implement-socket-live-update.patch

# PV shim debt
pv-shim-compat-dmc.patch

# vGPU
nvidia-vga.patch

# workspace pod debt
hvmloader-disable-pci-option-rom-loading.patch

# Nested virt tweaking knobs
xen-force-software-vmcs-shadow.patch
0001-x86-vvmx-add-initial-PV-EPT-support-in-L0.patch
use-msr-ll-instead-of-vmcs-efer.patch

add-pv-iommu-headers.patch
add-pv-iommu-local-domain-ops.patch
add-pv-iommu-foreign-support.patch
upstream-pv-iommu-tools.patch

# Intel GVT-g debt
allow-rombios-pci-config-on-any-host-bridge.patch
0007-hypercall-XENMEM_get_mfn_from_pfn.patch # Remove when PV-IOMMU code merged
gvt-g-hvmloader+rombios.patch # Intel to upstream

# VM Introspection Extensions
xen-introduce-cmdline-to-control-introspection-extensions.patch
xen-domctl-set-privileged-domain.patch
xen-reexecute-instn-under-monitor-trap.patch
revert-x86-mm-suppress-vm_events-caused-by-page-walks.patch
xen-emulate-Bypass-the-emulator-if-emulation-fails.patch
xen-introspection-pause.patch
xen-always-enable-altp2m-external-mode.patch

# Live microcode loading additions
xen-spec-ctrl-utility.patch

# vTPM support
0001-hvmloader-acpi-add-TPM-version-option.patch
0002-hvmloader-acpi-add-TPM2.patch
vtpm-ppi-acpi-dsm.patch

################################################################################
# Debugging patches
#
