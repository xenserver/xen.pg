#
# XenServer patch queue on top of xen.git
#    Upstream at git://xenbits.xen.org/xen.git
#
# In an effort to reduce future work of upgrading Xen versions, all patches in
# this queue require a justification as to why they can't/won't be upstreamed,
# with the implication that everything else should be upstreamed.
#
# If in any doubt, the ring0 patch queue maintainer will be happy to help.
#
# All patches should follow the guidelines listed here:
#       http://wiki.xen.org/wiki/Submitting_Xen_Patches
# in particular with respect to a description and S-o-b lines, with the
# exception of temporary debugging patches, which should contain at least a CA
# reference.
#
# Overview of sections:
# * XenServer build system integration.
#       **Minimal Upstream makefile hacks**
# * Upstream patches.
#       Verbatim patches from upstream, possibly with tweaks because of backporting
# * Patches for upstream.
#       Most patches should be in this section, especially new ones.  By using
#       this section, you are assuming responsibility for getting the patches
#       included upstream, and will be periodically chased by the patch queue
#       maintainer.
# * Un-upstreamable patches.
#       Default tweaks, etc.  Should be minimal.
# * Technical debt.
#       Legacy patches brought forward from the past.  This section should
#       never increase, and should progressively decrease.  **Remove when empty**
# * Debugging patches.
#       Temporary debugging patches, which must contain a CA reference.  Before
#       closing a ticket, you are expected to remove debugging patches.

################################################################################
# XenServer build system integration
#
build-tweaks.patch # Tweak version string, start-of-day banner and changeset
autoconf-libjson.patch

configure-build.patch # Configuration files for the build, including cached ./configure
xenserver-configuration.patch
coverity-model.patch

################################################################################
# Upstream patches
#
# Naming scheme: backport-<12 digit SHA>.patch # [*] <UTC TIMESTAMP> - <Commit subject>
#   A '*' indicates a patch which should be suggested for backport upstream

# Patches from master
backport-680d18763aef.patch #   2019-11-29 18:57:32 - AMD/IOMMU: Render IO_PAGE_FAULT errors in a more useful manner
backport-cd7dedad8209.patch #   2019-11-29 19:18:31 - passthrough: simplify locking and logging
backport-79cf0989175c.patch #   2019-12-05 12:31:03 - passthrough: drop break statement following c/s cd7dedad820
backport-6dd95b02ea27.patch #   2019-12-16 16:04:10 - x86/time: drop vtsc_{kern, user}count debug counters
backport-0cd791c499bd.patch #   2019-12-19 18:48:00 - tools/python: Drop test.py
backport-9356f9de4162.patch #   2019-12-20 15:26:09 - x86/ioapic: only use dest32 with x2apic and interrupt remapping enabled
backport-c08cbf7fb891.patch #   2019-12-20 15:27:48 - x86/apic: force phys mode if interrupt remapping is disabled
backport-3d05407025ed.patch #   2019-12-20 15:28:27 - x86/smp: check APIC ID on AP bringup
backport-b1710040ca96.patch #   2019-12-20 15:29:22 - x86/apic: allow enabling x2APIC mode regardless of interrupt remapping
backport-31bf4f26aa17.patch #   2019-12-20 16:08:00 - tools/libxc: Drop other examples of the 'goto x; } else if' antipattern
backport-e9bd648015dd.patch #   2019-12-24 14:59:04 - libxc/restore: Don't duplicate state in process_vcpu_basic()
backport-da9290639eb5.patch #   2019-12-26 15:57:04 - x86/vvmx: virtualize x2APIC mode and APIC accesses can't both be enabled
backport-7b3c5b70a323.patch #   2020-01-03 18:37:25 - tools/libxc: disable x2APIC when using nested virtualization
backport-1171a93b6ca7.patch #   2020-01-03 18:37:25 - tools/restore: Drop unused parameters from xc_domain_restore()
backport-2004db3ced18.patch #   2020-01-07 12:26:45 - tools/save: Drop unused parameters from xc_domain_save()
backport-59e1f6d89710.patch #   2020-01-15 15:22:28 - libxc/restore: Introduce functionality to simplify blob handling
backport-86cf92f50533.patch #   2020-01-15 15:22:28 - libxc/migration: Rationalise the 'checkpointed' field to 'stream_type'
backport-0a9c44486b90.patch #   2020-02-10 10:58:07 - tools/python: Drop cpuid helpers
backport-270ff9a835fb.patch #   2020-02-10 13:09:54 - tools/ocaml: Drop cpuid helpers
backport-dacb80f9757c.patch #   2020-02-11 18:26:52 - tools/libxl: Remove libxl_cpuid_{set,apply_policy}() from the API
backport-1b3cec69bf30.patch #   2020-02-11 18:26:52 - tools/libxl: Combine legacy CPUID handling logic
backport-8171e0796542.patch #   2020-02-17 19:10:55 - tools/libx[cl]: Don't use HVM_PARAM_PAE_ENABLED as a function parameter
backport-6094a3c4fee1.patch #   2020-02-26 12:13:10 - x86/gen-cpuid: Fix Py2/3 compatibility
backport-96dc77b4b182.patch #   2020-02-26 12:13:10 - x86/sysctl: Don't return cpu policy data for compiled-out support
backport-dca31274846c.patch #   2020-02-27 18:54:58 - x86/gen-cpuid: Rework internal logic to ease future changes
backport-625a95cc17d5.patch #   2020-02-27 18:54:58 - x86/sysctl: Don't return cpu policy data for compiled-out support (2)
backport-fd0ec12c3a41.patch #   2020-02-27 18:54:58 - x86/msr: Compile out unused logic/objects
backport-885d2d20425d.patch #   2020-02-27 18:54:58 - x86/cpuid: Compile out unused logic/objects
backport-9649cef3b3a7.patch #   2020-02-28 15:25:43 - AMD/IOMMU: correct handling when XT's prereq features are unavailable
backport-a798bac54fe8.patch #   2020-03-06 09:18:13 - x86/hvm: allow ASID flush when v != current
backport-920d5f31883c.patch #   2020-03-10 14:29:24 - x86/paging: add TLB flush hook
backport-c9495bd7dff5.patch #   2020-03-10 14:30:27 - x86/hap: improve hypervisor assisted guest TLB flush
backport-53ddfc80a84a.patch #   2020-03-11 12:17:41 - rcu: use rcu softirq for forcing quiescent state
backport-a9b6dacf88fe.patch #   2020-03-11 12:18:49 - rcu: fix rcu_lock_domain()
backport-7ff66809ccd5.patch #   2020-03-26 11:39:08 - x86emul: support AVX512_BF16 insns
backport-53594c7bd197.patch #   2020-03-26 11:43:23 - rcu: don't use stop_machine_run() for rcu_barrier()
backport-540d4d60378c.patch #   2020-03-26 11:49:42 - cpu: sync any remaining RCU callbacks before CPU up/down
backport-3174835ba825.patch #   2020-04-29 08:04:40 - x86/tlb: introduce a flush HVM ASIDs flag
backport-c2b4e23fdda4.patch #   2020-04-29 08:07:32 - x86/tlb: allow disabling the TLB clock
backport-e9aca9470ed8.patch #   2020-04-29 08:10:19 - x86/tlb: use Xen L0 assisted TLB flush when available
backport-68d757df8dd2.patch #   2020-04-29 21:13:00 - x86/pv: Options to disable and/or compile out 32bit PV support
backport-17b997aa1edb.patch #   2020-05-04 10:53:01 - x86/hap: be more selective with assisted TLB flush
backport-35b819c45c46.patch #   2020-05-07 18:58:04 - sched: print information about scheduling granularity
backport-d8a6a8b36d86.patch #   2020-05-13 20:33:42 - tools/libxc: Reduce feature handling complexity in xc_cpuid_apply_policy()
backport-54463aa79dac.patch #   2020-06-17 13:54:12 - x86/hvm: Disable MPX by default
backport-25636ed707cf.patch #   2020-06-18 16:45:14 - tools/xen-ucode: return correct exit code on failed microcode update
backport-4489ffdec331.patch #   2020-07-28 19:33:28 - x86/hvm: fix vIO-APIC build without IRQ0_SPECIAL_ROUTING
backport-ab5bfc049e8e.patch #   2020-07-28 19:33:28 - x86/hvm: don't force vCPU 0 for IRQ 0 when using fixed destination mode
backport-dc036ab9d506.patch #   2020-07-28 19:33:28 - x86/hvm: fix ISA IRQ 0 handling when set as lowest priority mode in IO APIC
backport-b9e9ccbb11e4.patch #   2020-07-28 19:33:28 - x86/vpt: only try to resume timers belonging to enabled devices
backport-b6641f28c593.patch #   2020-07-28 19:33:28 - x86/hvm: only translate ISA interrupts to GSIs in virtual timers
backport-a85f67b2658e.patch #   2020-07-31 15:18:41 - tools/configure: drop BASH configure variable
backport-a8ee9c4d3fb8.patch #   2020-08-05 16:35:11 - x86/ioapic: Fix style in io_apic.h
backport-80a868f0f6cc.patch #   2020-08-18 17:34:50 - tools/ocaml/xenstored: drop select based socket watching
backport-a06d3feea3b7.patch #   2020-10-08 13:54:00 - tools/ocaml/xenstored: drop the creation of the RO socket
backport-758fae24d7b9.patch #   2020-11-25 13:06:27 - xen/include: import sizeof_field() macro from Linux stddef.h
backport-e373bc1bdc59.patch #   2020-12-07 13:49:30 - x86/IRQ: make max number of guests for a shared IRQ configurable
backport-b7c333016e3d.patch #   2020-12-07 13:52:35 - x86/IRQ: allocate guest array of max size only for shareable IRQs
backport-1997d379dc64.patch #   2021-01-15 11:44:47 - tools/libxenevtchn: rename open_flags to flags
backport-f7918dc8f94c.patch #   2021-01-15 11:44:47 - tools/libxenevtchn: check xenevtchn_open() flags for not supported bits
backport-935e5fb0d570.patch #   2021-01-15 11:44:47 - tools/libxenevtchn: propagate xenevtchn_open() flags parameter
backport-29a6082f21f2.patch #   2021-01-15 11:44:47 - tools/libxenevtchn: add possibility to not close file descriptor on exec
backport-7f97193e6aa8.patch #   2021-01-21 16:29:44 - tools/xenstore: add live update command to xenstore-control
backport-e663158bca89.patch #   2021-01-22 14:55:10 - tools/oxenstored: Only quit on SIGTERM when a reload is possible
backport-4387b4c771fe.patch #   2021-01-22 15:22:42 - tools/oxenstored: Automatically resume when possible
backport-401c67e9bc8b.patch #   2021-01-22 16:49:21 - tools/oxenstored: Add cooperative live-update command
backport-00c48f57ab36.patch #   2021-01-22 16:50:18 - tools/oxenstored: Start live update process
backport-42f0581a91d4.patch #   2021-01-22 18:01:33 - tools/oxenstored: Implement live update for socket connections
backport-5e115dcf76f6.patch #   2021-01-22 18:01:34 - tools/oxenstored: Replace hand rolled GC with weak GC references
backport-faf02c345ec0.patch #   2021-01-22 18:01:34 - tools/oxenstored: Backport find_opt/update from 4.06
backport-3068dfd6415a.patch #   2021-01-22 18:01:35 - tools/oxenstored: Use more efficient node trees
backport-b1278939db0b.patch #   2021-01-22 18:01:35 - tools/oxenstored: Use more efficient tries
backport-7e5cffcd1e93.patch #   2021-01-29 13:18:43 - viridian: allow vCPU hotplug for Windows VMs
backport-81b2b328a26c.patch #   2021-02-24 11:48:13 - hvmloader: use Xen private header for elf structs
backport-60390ccb8b9b.patch #   2021-02-24 15:31:12 - elfstructs: add relocation defines for i386
backport-570da5423dbe.patch #   2021-03-01 23:19:39 - tools/hvmloader: Drop machelf include as well
backport-0eae016b6e3d.patch #   2021-03-01 23:19:39 - tools/firmware: Build firmware as -ffreestanding
backport-f40e1c52e4e0.patch #   2021-03-04 15:54:25 - tools/libxendevicemodel: Strip __XEN_TOOLS__ header guard
backport-368096b9c4a2.patch #   2021-03-11 17:27:48 - xen/dmop: Strip __XEN_TOOLS__ header guard from public ABI
backport-e21a6a4f966a.patch #   2021-04-09 10:31:17 - tools: Drop gettext as a build dependency
backport-935d501ccbf5.patch #   2021-04-09 10:31:17 - xen/xsm: Improve alloc/free of evtchn buckets
backport-27713fa2aa21.patch #   2021-04-13 08:14:23 - VT-d: improve save/restore of registers across S3
backport-3e9460ec9334.patch #   2021-04-15 12:45:09 - x86/amd: split LFENCE dispatch serializing setup logic into helper
backport-e9b4fe263649.patch #   2021-04-22 19:05:24 - x86/cpuid: support LFENCE always serialising CPUID bit
backport-fb23e8ba2304.patch #   2021-04-26 09:21:09 - x86/vPMU: Extend vPMU support to version 5
backport-08693c03e00e.patch #   2021-04-26 09:22:04 - x86/vtx: add LBR_SELECT to the list of LBR MSRs
backport-95419adfd4b2.patch #   2021-04-26 09:22:48 - x86/intel: insert Ice Lake-SP and Ice Lake-D model numbers
backport-f17d848c4caa-fix.patch #                   - x86/cpuid: Fix "x86/cpuid: Rework HLE and RTM handling" backport
backport-3670abcaf032.patch #   2021-05-27 19:34:00 - x86/tsx: Minor cleanup and improvements
backport-9fdcf851689c.patch #   2021-05-27 19:34:00 - x86/tsx: Deprecate vpmu=rtm-abort and use tsx=<bool> instead
backport-2d1a35f1e6c2.patch #   2021-06-08 15:35:00 - tools/ocaml: Fix redefinition errors
backport-3e09045991cd.patch #   2021-06-09 14:17:58 - x86/tsx: Cope with TSX deprecation on SKL/KBL/CFL/WHL
backport-b672695e7488.patch #   2021-06-15 20:50:32 - x86/msr: Expose MSR_ARCH_CAPS in the raw and host policies
backport-79ca512a1fa6.patch #   2021-07-09 16:38:27 - tools/tests: Drop obsolete mce-test infrastructure
backport-6a9f5477637a.patch #   2021-07-09 16:38:27 - tests/cpu-policy: Rework Makefile
backport-93c9edbef51b.patch #   2021-07-09 16:38:27 - tests/xenstore: Rework Makefile
backport-73c932d0ea43.patch #   2021-07-26 10:32:04 - tools/libxc: use uint32_t for pirq in xc_domain_irq_permission
backport-274c5e79c792.patch #   2021-08-16 13:16:56 - x86/ioapic: remove use of TRUE/FALSE/1/0
backport-1787cc167906.patch #   2021-08-19 18:34:53 - libs/guest: Move the guest ABI check earlier into xc_dom_parse_image()
backport-afab477fba3b.patch #   2021-08-27 14:19:02 - x86/spec-ctrl: Skip RSB overwriting when safe to do so
backport-c76cfada1cfa.patch #   2021-09-10 13:27:08 - tools/libacpi: Use 64-byte alignment for FACS
backport-f26bb285949b.patch #   2021-09-10 20:30:26 - xen: Implement xen/alternative-call.h for use in common code
backport-4624912c0b55.patch #   2021-09-10 20:30:26 - xsm: remove the ability to disable flask
backport-2928c1d250b1.patch #   2021-09-10 20:30:26 - xsm: remove remnants of xsm_memtype hook
backport-6d45368a0a89.patch #   2021-09-10 20:30:26 - xsm: drop dubious xsm_op_t type
backport-0a7ebb186106.patch #   2021-09-15 09:00:40 - x86/ACPI: ignore processors which cannot be brought online
backport-b17546d7f33e.patch #   2021-09-16 09:58:59 - xsm: apply coding style
backport-164a0b9653f4.patch #   2021-09-16 09:59:40 - xsm: refactor xsm_ops handling
backport-737190abb174.patch #   2021-09-16 10:00:17 - xsm: convert xsm_ops hook calls to alternative call
backport-e083d753924b.patch #   2021-09-21 19:41:12 - x86/hvm: Reduce stack usage from HVMTRACE_ND()
backport-91bac8ad7c06.patch #   2021-09-21 19:41:12 - x86/hvm: Remove duplicate calls caused by tracing
backport-dd6c062a7a4a.patch #   2021-09-24 11:07:50 - tools/libxl: Correctly align the ACPI tables
backport-9c3b9800e201.patch #   2021-09-28 15:04:50 - pci: fix handling of PCI bridges with subordinate bus number 0xff
backport-b11380f6cd58.patch #   2021-10-08 18:52:22 - x86/spec-ctrl: Build with BRANCH_HARDEN lfences by default
backport-b6b672e8a925.patch #   2021-10-11 09:58:44 - x86/HVM: fix xsm_op for 32-bit guests
backport-834cb8761051.patch #   2021-10-12 10:55:42 - x86/PV32: fix physdev_op_compat handling
backport-eb7518b89be6.patch #   2021-10-12 16:56:11 - x86/pv: Split pv_hypercall() in two
backport-f282182af329.patch #   2021-10-18 14:15:59 - tools/xenstore: set oom score for xenstore daemon on Linux
backport-9cfeb83cbe23.patch #   2021-10-18 14:17:28 - tools/xenstore: set open file descriptor limit for xenstored
backport-6809998c5f8f.patch #   2021-10-19 12:23:34 - tools: fix oom setting of xenstored
backport-245a320ce227.patch #   2021-11-29 13:53:05 - x86/IO-APIC: Drop function pointers from __ioapic_{read,write}_entry()
backport-c17072fc164a.patch #   2021-12-16 20:27:13 - x86/cpuid: Split dom0 handling out of init_domain_cpuid_policy()
backport-94c3df9188d6.patch #   2021-12-16 20:27:13 - x86/cpuid: Factor common parsing out of parse_xen_cpuid()
backport-5bd2b82df28c.patch #   2021-12-16 20:27:13 - x86/cpuid: Introduce dom0-cpuid command line option
backport-31f3bc97f450.patch #   2022-01-05 09:44:26 - x86/spec-ctrl: Fix default calculation of opt_srb_lock
backport-b07050e1e8f7.patch #   2022-01-19 12:45:11 - x86/mwait-idle: update ICX C6 data
backport-88d3ff7ab15d.patch #   2022-01-20 16:32:11 - x86/guest: Introduce {get,set}_reg() infrastructure
backport-6536688439db.patch #   2022-01-20 16:32:11 - x86/msr: Split MSR_SPEC_CTRL handling
backport-81f0eaadf84d.patch #   2022-01-20 16:32:11 - x86/spec-ctrl: Fix NMI race condition with VT-x MSR_SPEC_CTRL handling
backport-e3662437eb43.patch #   2022-01-27 17:38:15 - x86/cpuid: Disentangle logic for new feature leaves
backport-e1828e3032eb.patch #   2022-01-27 17:38:15 - x86/cpuid: Infrastructure for leaf 7:1.ebx
backport-969a57f73f6b.patch #   2022-01-27 17:59:18 - x86/msr: Fix migration compatibility issue with MSR_SPEC_CTRL
backport-15b7611efd49.patch #   2022-02-01 13:20:44 - x86/cpuid: Advertise SSB_NO to guests by default
backport-00f2992b6c7a.patch #   2022-02-01 13:20:44 - x86/spec-ctrl: Record the last write to MSR_SPEC_CTRL
backport-614cec7d79d7.patch #   2022-02-01 13:20:44 - x86/svm: VMEntry/Exit logic for MSR_SPEC_CTRL
backport-22b9add22b4a.patch #   2022-02-01 13:20:44 - x86/msr: AMD MSR_SPEC_CTRL infrastructure
backport-a7e7c7260cde.patch #   2022-02-01 13:20:44 - x86/cpuid: Enable MSR_SPEC_CTRL in SVM guests by default
backport-f97c1abf2934.patch #   2022-02-07 17:41:24 - xen/smp: Speed up on_selected_cpus()
backport-39a40f3835ef.patch #   2022-02-08 18:00:08 - x86/spec-ctrl: Clean up MSR_MCU_OPT_CTRL handling
backport-4116139131e9.patch #   2022-02-08 18:00:08 - x86/tsx: Move has_rtm_always_abort to an outer scope
backport-ad9f7c3b2e0d.patch #   2022-02-08 18:00:08 - x86/tsx: Cope with TSX deprecation on WHL-R/CFL-R
backport-f3709b15fc86.patch #   2022-02-08 18:00:08 - x86/cpuid: Infrastructure for cpuid word 7:2.edx
backport-52ce1c97844d.patch #   2022-02-08 18:00:08 - x86/spec-ctrl: Support Intel PSFD for guests
backport-81d195c6c0e2.patch #   2022-02-18 13:42:39 - x86: introduce ioremap_wc()
backport-f627a39c5e75.patch #   2022-02-18 13:44:32 - video/vesa: unmap frame buffer when relinquishing console
backport-6ba701064227.patch #   2022-02-18 13:45:14 - video/vesa: drop "vesa-mtrr" command line option
backport-7f7e55b85fce.patch #   2022-02-18 13:45:45 - video/vesa: drop "vesa-remap" command line option
backport-ea140035d01a.patch #   2022-02-18 13:46:27 - video/vesa: adjust (not just) command line option handling
backport-e270af94280e.patch #   2022-04-04 11:30:07 - tools/firmware: do not add a .note.gnu.property section
backport-ae49ee66cfda.patch #   2022-05-18 10:21:49 - x86/cpuid: expose MCDT_NO to guests
backport-cea9ae062295.patch #   2022-06-06 18:15:46 - x86/spec-ctrl: Enumeration for new Intel BHI controls
backport-d4012d50082c.patch #   2022-04-07 11:36:45 - x86/cpuid: Clobber CPUID leaves 0x800000{1d..20} in policies
backport-69e1472d21cf.patch #   2021-06-07 15:43:35 - x86/cpuid: Drop special_features[]
backport-60d1adfa1879.patch #   2022-06-30 18:07:13 - x86/ept: fix shattering of special pages
backport-e570e8d520ab.patch #   2022-08-05 12:16:24 - x86/spec-ctrl: Use IST RSB protection for !SVM systems
backport-a0aeab27ee0e.patch #   2022-08-05 17:30:57 - tools/ocaml: fix compiler warnings
backport-e83cd54611fe.patch #   2022-08-09 16:35:25 - x86: Expose more MSR_ARCH_CAPS to hwdom
backport-b874e47eb13f.patch #   2022-08-11 16:19:50 - x86/spec-ctrl: Enumeration for PBRSB_NO
backport-0f2611c52438.patch #   2022-08-17 12:50:48 - x86/traps: Make nmi_show_execution_state() more useful
backport-c3bd0b83ea5b.patch #   2022-08-24 13:23:59 - x86/CPUID: surface suitable value in EBX of XSTATE subleaf 1
backport-c4e5cc2ccc5b.patch #   2022-09-29 12:44:10 - x86/ept: limit calls to memory_type_changed()
backport-7110192b1df6.patch #   2022-10-20 15:48:22 - tools/oxenstored: Fix Oxenstored Live Update
backport-f838b956779f.patch #   2022-10-21 10:28:12 - tools/ocaml/xenstored: fix live update exception
backport-9272225ca728.patch #   2022-10-28 14:47:59 - x86/pv-shim: correctly ignore empty onlining requests
backport-a0bfdd201ea1.patch #   2022-10-28 14:48:50 - x86/pv-shim: correct ballooning up for compat guests
backport-1d7fbc535d1d.patch #   2022-10-28 14:49:33 - x86/pv-shim: correct ballooning down for compat guests
backport-37f82facd62f.patch #   2022-11-04 08:03:23 - xen/sched: migrate timers to correct cpus after suspend
backport-57f07cca8252.patch #   2022-11-21 11:21:51 - efifb: ignore frame buffer with invalid configuration
backport-c3b6be714c64.patch #   2022-12-01 16:07:17 - tools/ocaml/xenctrl: Make domain_getinfolist tail recursive
backport-95db09b1b154.patch #   2022-12-01 16:07:17 - tools/ocaml/xenctrl: Use larger chunksize in domain_getinfolist
backport-ee36179371fd.patch #   2022-12-01 16:07:17 - tools/oxenstored: Fix incorrect scope after an if statement
backport-22d5affdf0ce.patch #   2022-12-01 16:07:17 - tools/ocaml/evtchn: OCaml 5 support, fix potential resource leak
backport-7ba68a6c558e.patch #   2022-12-01 16:07:17 - tools/ocaml/evtchn: Add binding for xenevtchn_fdopen()
backport-9bafe4a53306.patch #   2022-12-01 16:07:17 - tools/ocaml/evtchn: Extend the init() binding with a cloexec flag
backport-b45bfaf359e4.patch #   2022-12-01 16:07:17 - tools/oxenstored: Style fixes to Domain
backport-9804a5db435f.patch #   2022-12-01 16:07:17 - tools/oxenstored: Bind the DOM_EXC VIRQ in in Event.init()
backport-31fbee749a75.patch #   2022-12-01 16:07:17 - tools/oxenstored: Rename some 'port' variables to 'remote_port'
backport-aecdc28d9538.patch #   2022-12-01 16:07:17 - tools/oxenstored: Implement Domain.rebind_evtchn
backport-df2db174b36e.patch #   2022-12-01 16:07:17 - tools/oxenstored: Rework Domain evtchn handling to use port_pair
backport-9b224c25293a.patch #   2022-12-01 16:07:17 - tools/oxenstored: Keep /dev/xen/evtchn open across live update
backport-3f02e0a70fe9.patch #   2022-12-01 16:07:17 - tools/oxenstored: Log live update issues at warning level
backport-ee7815f49faf.patch #   2022-12-01 16:07:17 - tools/oxenstored: Set uncaught exception handler
backport-acd3fb6d6590.patch #   2022-12-01 16:07:17 - tools/oxenstored/syslog: Avoid potential NULL dereference
backport-f1d7aac1e3c3.patch #   2022-12-02 09:35:01 - x86/HVM: don't mark external IRQs as pending when vLAPIC is disabled
backport-e267d11969a4.patch #   2022-12-02 09:32:21 - x86/irq: do not release irq until all cleanup is done
backport-831419f82913.patch #   2022-12-02 09:35:32 - x86/Viridian: don't mark IRQ vectors as pending when vLAPIC is disabled
backport-d2162d884cba.patch #   2022-12-02 13:41:04 - tools/oxenstored: Render backtraces more nicely in Syslog
backport-ff95dae53e5e.patch #   2022-12-02 13:41:04 - tools/ocaml/xenctrl: Add binding for xc_evtchn_status
backport-10acd21795a9.patch #   2022-12-02 13:41:04 - tools/ocaml/xenctrl: Add hvm_param_{get,set} bindings
backport-f5d0279839b5.patch #   2022-12-06 12:51:49 - x86/HVM: don't mark evtchn upcall vector as pending when vLAPIC is disabled
backport-a44734df6c24.patch #   2022-12-07 11:17:30 - ioreq_broadcast(): accept partial broadcast success
backport-f7d07619d2ae.patch #   2022-12-19 10:22:43 - x86/vmx: implement VMExit based guest Bus Lock detection
backport-d329b37d1213.patch #   2022-12-19 10:23:34 - x86/vmx: introduce helper to set VMX_INTR_SHADOW_NMI
backport-573279cde1c4.patch #   2022-12-19 10:24:14 - x86/vmx: implement Notify VM Exit
backport-ad15a0a8ca25.patch #   2022-12-19 10:34:16 - x86/time: prevent overflow with high frequency TSCs
backport-e94af0d58f86.patch #   2023-01-12 18:42:00 - x86/vmx: Calculate model-specific LBRs once at start of day
backport-3edca52ce736.patch #   2023-01-12 18:42:00 - x86/vmx: Support for CPUs without model-specific LBR
backport-5f08bc9404c7.patch #   2023-01-20 19:39:32 - x86/vmx: Partially revert "x86/vmx: implement Notify VM Exit"
backport-e6f07052ce4a.patch #   2023-02-06 10:22:12 - tools/oxenstored: validate config file before live update
backport-ff8b560be80b.patch #   2023-02-06 10:22:12 - tools/ocaml/libs: Don't declare stubs as taking void
backport-36eb2de31b6e.patch #   2023-02-06 10:22:12 - tools/ocaml/libs: Allocate the correct amount of memory for Abstract_tag
backport-2636d8ff7a67.patch #   2023-02-06 10:22:12 - tools/ocaml/evtchn: Don't reference Custom objects with the GC lock released
backport-425068384210.patch #   2023-02-06 10:22:12 - tools/ocaml/xc: Fix binding for xc_domain_assign_device()
backport-9e7c74e6f9fd.patch #   2023-02-06 10:22:12 - tools/ocaml/xc: Don't reference Abstract_Tag objects with the GC lock released
backport-d69ccf52ad46.patch #   2023-02-06 10:22:12 - tools/ocaml/libs: Fix memory/resource leaks with caml_alloc_custom()
backport-b4a23bf6293a.patch #   2023-02-09 18:26:17 - x86/cpuid: Infrastructure for leaves 7:1{ecx,edx}
backport-eddf13b5e940.patch #   2022-02-14 09:08:38 - x86emul: fix VPBLENDMW with mask and memory operand
backport-63305e5392ec.patch #   2023-02-14 17:53:32 - x86/spec-ctrl: Mitigate Cross-Thread Return Address Predictions
backport-f4ef8a41b808.patch #   2023-02-21 14:08:05 - x86/ucode/AMD: apply the patch early on every logical thread
backport-f1315e48a03a.patch #   2023-02-28 13:51:28 - x86/ucode/AMD: late load the patch on every logical thread
backport-1ba66a870eba.patch #   2020-03-10 14:25:58 - AMD/IOMMU: without XT, x2APIC needs to be forced into physical mode
backport-9276e832aef6.patch #   2023-03-13 11:26:26 - x86/spec-ctrl: Add BHI controls to userspace components
backport-d04ae78c34e7.patch #   2023-03-13 11:26:26 - x86/spec-ctrl: Enumerations for DDP controls
backport-4a5577940240.patch #   2023-03-13 11:26:26 - tools/xen-cpuid: Support dash as a bitmap separator
backport-ec3474e1dd42.patch #   2023-03-13 11:26:26 - tools/xen-cpuid: Rework the handling of dynamic featuresets
backport-433d012c6c27-partial.patch #   2023-03-13 11:26:26 - x86/sysctl: Retrofit XEN_SYSCTL_cpu_featureset_{pv,hvm}_max
backport-33fb3a661223.patch #   2023-03-21 12:07:41 - x86/shadow: account for log-dirty mode when pre-allocating
backport-d484dcca7972.patch #   2023-03-21 12:07:41 - x86/HVM: bound number of pinned cache attribute regions
backport-ab2d47eb1353.patch #   2023-03-21 12:07:42 - x86/HVM: serialize pinned cache attribute list manipulation
backport-245d030f4aa7.patch #   2023-03-21 12:07:42 - x86/spec-ctrl: Defer CR4_PV32_RESTORE on the cstar_enter path
backport-fc2e1f3aad60.patch #   2023-03-28 11:57:56 - x86/ucode: Fix error paths control_thread_fn()
backport-c2ec94c370f2.patch #   2023-04-05 11:47:08 - x86: Rename struct cpu_policy to struct old_cpuid_policy
backport-21e3ef57e040.patch #   2023-04-05 11:47:08 - x86: Rename {domctl,sysctl}.cpu_policy.{cpuid,msr}_policy fields
backport-743e530380a0.patch #   2023-04-05 11:47:08 - x86: Rename struct cpuid_policy to struct cpu_policy
backport-03812da3754d.patch #   2023-04-05 11:47:08 - x86: Merge struct msr_policy into struct cpu_policy
backport-6bc33366795d.patch #   2023-04-05 11:47:08 - x86: Merge the system {cpuid,msr} policy objects
backport-bd13dae34809.patch #   2023-04-05 11:47:08 - x86: Merge a domain's {cpuid,msr} policy objects
backport-c9985233ca66.patch #   2023-04-05 11:47:08 - x86: Merge xc_cpu_policy's cpuid and msr objects
backport-66c5c9965631.patch #   2023-04-05 11:47:08 - x86: Drop struct old_cpu_policy
backport-1027df4c0082.patch #   2023-04-05 11:47:08 - x86: Out-of-inline the policy<->featureset convertors
backport-4f20f596ce9b.patch #   2023-04-05 11:47:08 - x86/boot: Move MSR policy initialisation logic into cpu-policy.c
backport-8eb56eb959a5.patch #   2023-04-05 11:47:08 - x86/boot: Merge CPUID policy initialisation logic into cpu-policy.c
backport-441b1b2a50ea.patch #   2023-04-05 11:47:08 - x86/emul: Switch x86_emulate_ctxt to cpu_policy
backport-a16dcd48c2db.patch #   2023-04-05 11:47:08 - tools/fuzz: Rework afl-policy-fuzzer
backport-1b67fccf3b02.patch #   2023-04-05 11:47:08 - libx86: Update library API for cpu_policy
backport-994c1553a158.patch #   2023-04-05 11:47:08 - x86: Remove temporary {cpuid,msr}_policy defines
backport-19c6cbd90965.patch #   2023-05-03 11:36:05 - xen/vcpu: ignore VCPU_SSHOTTMR_future
backport-0946068e7fae.patch #   2023-05-03 11:36:25 - x86/head: check base address alignment
backport-eaa324bfebcf.patch #   2023-05-03 11:37:19 - x86/trampoline: load the GDT located in the trampoline page
backport-f1e574fa6dea.patch #   2023-05-03 18:36:46 - tools/xenctrl: add xc_get_cpu_version()
backport-161c37d020a7.patch #   2023-05-03 18:36:46 - x86/platform: introduce XENPF_get_ucode_revision
backport-b95a72bb5b2d.patch #   2023-05-03 18:36:46 - tools/xen-ucode: print information about currently loaded ucode
backport-8b1ac353b4db.patch #   2023-05-09 10:37:29 - docs/man: fix xenstore-write synopsis
backport-694d79ed5aac.patch #   2023-05-10 19:59:27 - x86/ucode: Refresh raw CPU policy after microcode load
backport-4c507d8a6b6e.patch #   2023-05-12 07:35:36 - iommu/amd-vi: fix assert comparing boolean to enum
backport-56e2c8e58600.patch #   2023-05-15 11:03:11 - x86/cpuid: Calculate FEATURESET_NR_ENTRIES more helpfully
backport-ef1987fcb0fd.patch #   2023-05-24 19:04:41 - x86/boot: Rework dom0 feature configuration
backport-43912f8dbb18.patch #   2023-05-24 19:04:41 - x86/boot: Adjust MSR_ARCH_CAPS handling for the Host policy
backport-d9fe459ffad8.patch #   2023-05-24 19:04:41 - x86/cpu-policy: Infrastructure for MSR_ARCH_CAPS
backport-ce8c930851a5.patch #   2023-05-24 19:04:41 - x86/cpu-policy: MSR_ARCH_CAPS feature names
backport-70553000d6b4.patch #   2023-05-24 19:04:41 - x86/boot: Record MSR_ARCH_CAPS for the Raw and Host CPU policy
backport-bbb289f3d5bd.patch #   2023-05-24 19:04:41 - x86/boot: Expose MSR_ARCH_CAPS data in guest max policies
backport-8f6bc7f9b72e.patch #   2023-05-24 19:04:41 - x86/vtx: Remove opencoded MSR_ARCH_CAPS check
backport-205a9f970378.patch #   2023-05-24 19:04:41 - x86/tsx: Remove opencoded MSR_ARCH_CAPS check
backport-511b9f286c3d.patch #   2023-05-24 19:04:41 - x86/spec-ctrl: Remove opencoded MSR_ARCH_CAPS check
backport-94200e1bae07.patch #   2023-05-30 18:24:07 - x86/spec-ctrl: Update hardware hints
backport-921afcbae843.patch #   2023-06-16 14:23:38 - x86/spec-ctrl: Fix the rendering of FB_CLEAR
backport-724c0d94ff79.patch #   2023-06-16 14:23:38 - x86/spec-ctrl: Rename retpoline_safe() to retpoline_calculations()
backport-36525a964fb6.patch #   2023-06-16 14:23:38 - x86/spec-ctrl: Fix up the RSBA/RRSBA bits as appropriate
backport-e0586a4ff514.patch #   2023-06-16 14:23:38 - x86/cpu-policy: Derive RSBA/RRSBA for guest policies
backport-aab4b38b5d77.patch #   2023-06-30 11:25:33 - xenalyze: Handle start-of-day ->RUNNING transitions
backport-c81b287e00b1.patch #   2023-06-30 11:29:06 - xenalyze: Basic TRC_HVM_EMUL handling
backport-813da5f0e73b.patch #   2023-07-17 08:31:10 - x86/ioapic: sanitize IO-APIC pins before enabling lapic LVTERR/ESR
backport-f91c5ea97067.patch #   2023-07-24 17:07:14 - x86/amd: Mitigations for Zenbleed
backport-4b2cdbfe766e.patch #   2023-07-26 10:56:27 - x86/cpu-policy: Advertise MSR_ARCH_CAPS to guests by default
backport-cdc48cb5a74b.patch #   2023-07-28 07:39:44 - x86/ioapic: add a raw field to RTE struct
backport-ef7995ed1bcd.patch #   2023-07-28 07:40:20 - x86/ioapic: RTE modifications must use ioapic_write_entry
backport-a478b38c01b6.patch #   2023-07-28 07:40:42 - iommu/vtd: rename io_apic_read_remap_rte() local variable
backport-f7065b24f4fb.patch #   2023-07-31 13:05:48 - amd: disable C6 after 1000 days on Zen2
backport-c0dd53b8cbd1.patch #   2023-07-31 13:50:54 - x86/amd: Fix DE_CFG truncation in amd_check_zenbleed()
backport-3e033172b025.patch #   2023-08-01 10:48:39 - x86/iommu: pass full IO-APIC RTE for remapping table update
backport-292f68fb7719.patch #   2023-08-08 15:19:49 - x86/spec-ctrl: Rework ibpb_calculations()
backport-2280b0ee2aed.patch #   2023-08-08 15:19:49 - x86/spec-ctrl: Enumerations for Speculative Return Stack Overflow
backport-220c06e6fefe.patch #   2023-08-08 15:19:49 - x86/spec-ctrl: Mitigate Speculative Return Stack Overflow
backport-2dd06b4ea108.patch #   2023-08-08 15:19:49 - x86/cpu-policy: Hide CLWB by default on SKX/CLX/CPX
backport-9f585f59d90c.patch #   2023-08-08 15:19:49 - x86/spec-ctrl: Enumerations for Gather Data Sampling
backport-56d690efd3ca.patch #   2023-08-08 15:19:49 - x86/spec-ctrl: Mitigate Gather Data Sampling
backport-145a69c0944a.patch #   2023-08-23 08:26:36 - x86/AMD: extend Zenbleed check to models "good" ucode isn't known for
backport-0742b0a081c2.patch #   2023-08-24 19:55:08 - tools/oxenstored: Additional debugging commands
backport-47342d8f490c.patch #   2023-08-29 14:54:45 - x86/ACPI: Ignore entries with invalid APIC IDs when parsing MADT
backport-8c01f267eff3.patch #   2023-08-29 14:54:45 - xen/console: Set the default log level to INFO for release builds
backport-709f6c8ce642.patch #   2023-08-30 08:03:53 - x86/irq: fix reporting of spurious i8259 interrupts
backport-1c18d7377453.patch #   2023-09-18 16:43:01 - x86/spec-ctrl: Fix confusion between SPEC_CTRL_EXIT_TO_XEN{,_IST}
backport-694bb0f280fd.patch #   2023-09-18 16:43:01 - x86/spec-ctrl: Fold DO_SPEC_CTRL_EXIT_TO_XEN into it's single user
backport-7125429aafb9.patch #   2023-09-18 16:43:01 - x86/spec-ctrl: Turn the remaining SPEC_CTRL_{ENTRY,EXIT}_* into asm macros
backport-45f00557350d.patch #   2023-09-18 16:43:01 - x86/spec-ctrl: Improve all SPEC_CTRL_{ENTER,EXIT}_* comments
backport-7aa28849a115.patch #   2023-09-18 16:43:01 - x86/entry: Adjust restore_all_xen to hold stack_end in %r14
backport-21bdc25b05a0.patch #   2023-09-18 16:43:01 - x86/entry: Track the IST-ness of an entry for the exit paths
backport-3ee6066bcd73.patch #   2023-09-18 16:43:01 - x86/spec-ctrl: Issue VERW during IST exit to Xen
backport-de1d26500139.patch #   2023-09-18 16:43:01 - x86/amd: Introduce is_zen{1,2}_uarch() predicates
backport-b5926c6ecf05.patch #   2023-09-18 16:43:01 - x86/spec-ctrl: Mitigate the Zen1 DIV leakage

x86-Activate-Data-Operand-Invariant-Timing-Mode-by-d.patch

################################################################################
# Patches for upstream
#

0001-x86-AMD-make-HT-range-dynamic-for-Fam17-and-up.patch
0001-tools-Fix-pkg-config-file-for-libxenstore.patch

# vPIT servies v1
0006-x86-vpt-fix-injection-to-remote-vCPU.patch

detect-nehalem-c-state.patch # malcolmc
quirk-hp-gen8-rmrr.patch # malcolmc
quirk-pci-phantom-function-devices.patch # malcolmc

# Hpet improvements v5
0001-x86-hpet-Pre-cleanup.patch
0002-x86-hpet-Use-singe-apic-vector-rather-than-irq_descs.patch
0003-x86-hpet-Post-cleanup.patch

0002-libxc-retry-shadow-ops-if-EBUSY-is-returned.patch

# Grant perf improvements
avoid-gnt-unmap-tlb-flush-if-not-accessed.patch

# Further MB2/EFI fixes
0002-efi-Ensure-incorrectly-typed-runtime-services-get-ma.patch
0001-x86-time-Don-t-use-EFI-s-GetTime-call.patch
0001-efi-Workaround-page-fault-during-runtime-service.patch

0001-x86-HVM-Avoid-cache-flush-operations-during-hvm_load.patch # rossla - CA-168080
0001-libxl-Don-t-insert-PCI-device-into-xenstore-for-HVM-.patch # rossla - CA-168029

# PoD extra mitigations
0001-x86-PoD-Command-line-option-to-prohibit-any-PoD-oper.patch

livepatch-ignore-duplicate-new.patch

# Reduce use of __LINE__
0001-lib-Add-a-generic-implementation-of-current_text_add.patch
0002-sched-Remove-dependency-on-__LINE__-for-release-buil.patch

# btrfs support for PV guests
pygrub-Ignore-GRUB2-if-statements.patch
libfsimage-Add-support-for-btrfs.patch

quiet-broke-irq-affinity.patch # rossla

# MSR policy
0001-x86-msr-Blacklist-various-MSRs-which-guests-definite.patch

# AVX-512
0001-Hide-AVX-512-from-guests-by-default.patch

# memory scrubbing
0001-common-page_alloc-don-t-idle-scrub-before-microcode-.patch

0001-xsm-hide-detailed-Xen-version-from-unprivileged-gues.patch

0003-credit-Limit-load-balancing-to-once-per-millisecond.patch

################################################################################
# Un-upstreamable patches
#
xen-tweak-cmdline-defaults.patch
xen-tweak-debug-overhead.patch
tweak-iommu-policy.patch
tweak-sc-policy.patch
disable-core-parking.patch

0001-Allocate-space-in-structs-pre-emptively-to-increase-.patch

0001-x86-mm-partially-revert-37201c62-make-logdirty-and-i.patch

# This will need to use Flask, when Flask is suitably ready
hitachi-driver-domain-ssid.patch

################################################################################
# Technical debt
#

# xen debt
livepatch-payload-in-header.patch
xen-define-offsets-for-kdump.patch
xen-scheduler-auto-privdom-weight.patch
xen-hvm-disable-tsc-ramping.patch
xen-default-cpufreq-governor-to-performance-on-intel.patch
0001-Partially-revert-08754333892-hvmloader-limit-CPUs-ex.patch
0001-x86-pv-silently-discard-writes-into-MSR_AMD64_LS_CFG.patch # Remove when SSBD handling on AMD is reworked
i8259-timers-pick-online-vcpu.patch

# libxc debt
revert-ca2eee92df44.patch # 2008-09-30 09:14:54 - x86, hvm: Expose host core/HT topology to HVM guests - needs removing in a migrate-safe way.
libxc-stubs-hvm_check_pvdriver.patch
libxc-cpuid-cores_per_socket.patch
libxc-cpu-policies.patch
max-featureset-compat.patch

# pygrub debt
pygrub-add-default-and-extra-args.patch
pygrub-always-boot-default.patch
pygrub-friendly-no-fs.patch
pygrub-image-max-size.patch
pygrub-default-xenmobile-kernel.patch
pygrub-blacklist-support.patch

# Ucode debt
ucode-compat.patch

# BIOS debt
oem-bios-xensource.patch # Can probably all be discarded
oem-bios-magic-from-xenstore.patch # Need to tweak, but should be upstreamed

# misc debt
misc-log-guest-consoles.patch
fix-ocaml-libs.patch
ocaml-cpuid-helpers.patch

# xentop debt
xentop-vbd3.patch

# mixed between components
mixed-domain-runstates.patch
xenguest.patch
xen-vmdebug.patch

oxenstore-censor-sensitive-data.patch
oxenstore-large-packets.patch

# vGPU
nvidia-vga.patch

# workspace pod debt
hvmloader-disable-pci-option-rom-loading.patch

# Nested virt tweaking knobs
xen-force-software-vmcs-shadow.patch
0001-x86-vvmx-add-initial-PV-EPT-support-in-L0.patch
use-msr-ll-instead-of-vmcs-efer.patch

add-pv-iommu-headers.patch
add-pv-iommu-local-domain-ops.patch
add-pv-iommu-foreign-support.patch
upstream-pv-iommu-tools.patch

# Intel GVT-g debt
allow-rombios-pci-config-on-any-host-bridge.patch
0007-hypercall-XENMEM_get_mfn_from_pfn.patch # Remove when PV-IOMMU code merged
gvt-g-hvmloader+rombios.patch # Intel to upstream

# VM Introspection Extensions
xen-introduce-cmdline-to-control-introspection-extensions.patch
xen-domctl-set-privileged-domain.patch
xen-reexecute-instn-under-monitor-trap.patch
revert-x86-mm-suppress-vm_events-caused-by-page-walks.patch
xen-emulate-Bypass-the-emulator-if-emulation-fails.patch
xen-introspection-pause.patch
xen-always-enable-altp2m-external-mode.patch

# Live microcode loading additions
xen-spec-ctrl-utility.patch

################################################################################
# Hotfix patches
#
