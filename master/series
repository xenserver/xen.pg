#
# XenServer patch queue on top of xen.git
#    Upstream at git://xenbits.xen.org/xen.git
#
# In an effort to reduce future work of upgrading Xen versions, all patches in
# this queue require a justification as to why they can't/won't be upstreamed,
# with the implication that everything else should be upstreamed.
#
# If in any doubt, the ring0 patch queue maintainer will be happy to help.
#
# All patches should follow the guidelines listed here:
#       http://wiki.xen.org/wiki/Submitting_Xen_Patches
# in particular with respect to a description and S-o-b lines, with the
# exception of temporary debugging patches, which should contain at least a CA
# reference.
#
# Overview of sections:
# * XenServer build system integration.
#       **Minimal Upstream makefile hacks**
# * Upstream patches.
#       Verbatim patches from upstream, possibly with tweaks because of backporting
# * Patches for upstream.
#       Most patches should be in this section, especially new ones.  By using
#       this section, you are assuming responsibility for getting the patches
#       included upstream, and will be periodically chased by the patch queue
#       maintainer.
# * Un-upstreamable patches.
#       CC-mode restrictions etc.  Should be minimal.
# * Technical debt.
#       Legacy patches brought forward from the past.  This section should
#       never increase, and should progressively decrease.  **Remove when empty**
# * Debugging patches.
#       Temporary debugging patches, which must contain a CA reference.  Before
#       closing a ticket, you are expected to remove debugging patches.

################################################################################
# XenServer build system integration
#
build-disable-qemu-trad.patch # Disable the qemu trad build while still letting the tools think it exists
build-tweaks.patch # Tweak version string, start-of-day banner and changeset
disable-efi.patch

configure-build.patch # Configuration files for the build, including cached ./configure
builder-makefiles.patch # XS Makefile and Spec file
changeset-info.patch
xenserver-configuration.patch
coverity-model.patch

################################################################################
# Upstream patches
#
# Naming scheme: backport-<12 digit SHA>.patch # [*] <UTC TIMESTAMP> - <Commit subject>
#   A '*' indicates a patch which should be suggested for backport upstream

# Patches from stable-4.7
backport-087369973214.patch #   2018-07-30 13:06:44 - cmdline: fix parse_boolean() for NULL incoming end pointer
backport-dc111e9f0d99.patch #   2018-07-30 13:08:08 - xen: Port the array_index_nospec() infrastructure from Linux
backport-a4041364c3ae.patch #   2018-07-30 13:08:42 - x86/spec-ctrl: command line handling adjustments
backport-9858a1f3fb9a.patch #   2018-07-30 13:09:19 - allow cpu_down() to be called earlier
backport-c0e854be515b.patch #   2018-07-30 13:09:57 - cpupools: fix state when downing a CPU failed
backport-e90e2431a4ae.patch #   2018-07-30 13:10:30 - x86/AMD: distinguish compute units from hyper-threads
backport-97aff087fd0b.patch #   2018-07-30 13:10:58 - x86: distinguish CPU offlining from CPU removal
backport-fa807e2ff69d.patch #   2018-07-30 13:11:42 - x86: possibly bring up all CPUs even if not all are supposed to be used
backport-bce2dd64b52e.patch #   2018-07-30 13:12:39 - x86: command line option to avoid use of secondary hyper-threads
backport-91ca84c862b1.patch #   2018-07-30 13:13:09 - x86/spec-ctrl: Fix the parsing of xpti= on fixed Intel hardware
backport-51d97807651a.patch #   2018-08-14 17:27:58 - x86/spec-ctrl: Yet more fixes for xpti= parsing
backport-0e66281fda98.patch #   2018-08-14 17:27:58 - x86/vmx: Defer vmx_vmcs_exit() as long as possible in construct_vmcs()
backport-a51e6a362f8a.patch #   2018-08-14 17:27:58 - x86/vmx: API improvements for MSR load/save infrastructure
backport-fe028e615c9d.patch #   2018-08-14 17:27:58 - x86/vmx: Internal cleanup for MSR load/save infrastructure
backport-87dba8038bcb.patch #   2018-08-14 17:27:59 - x86/vmx: Factor locate_msr_entry() out of vmx_find_msr() and vmx_add_msr()
backport-ded2a37d63de.patch #   2018-08-14 17:27:59 - x86/vmx: Support remote access to the MSR lists
backport-95ff4e192c4c.patch #   2018-08-14 17:27:59 - x86/vmx: Support load-only guest MSR list entries
backport-dfee8113ea8b.patch #   2018-08-14 17:27:59 - VMX: fix vmx_{find,del}_msr() build
backport-bcbd8b968939.patch #   2018-08-14 17:27:59 - common/gnttab: Introduce command line feature controls
backport-3f7fd2bb7339.patch #   2018-08-14 17:27:59 - ARM: disable grant table v2
backport-59732fd01409.patch #   2018-08-14 17:27:59 - x86/vtx: Fix the checking for unknown/invalid MSR_DEBUGCTL bits
backport-df66c1cb1926.patch #   2018-08-14 17:27:59 - tools/oxenstored: Make evaluation order explicit
backport-61c436028482.patch #   2018-08-14 17:28:09 - x86/spec-ctrl: Calculate safe PTE addresses for L1TF mitigations
backport-c9641d4b1fa4.patch #   2018-08-14 17:28:16 - x86/spec-ctrl: Introduce an option to control L1TF mitigation for PV guests
backport-1fdb25a614b2.patch #   2018-08-14 17:28:51 - x86/shadow: Infrastructure to force a PV guest into shadow mode
backport-0abc1aee7c1c.patch #   2018-08-14 17:28:58 - x86/mm: Plumbing to allow any PTE update to fail with -ERESTART
backport-1a908037ee92.patch #   2018-08-14 17:29:03 - x86/pv: Force a guest into shadow mode when it writes an L1TF-vulnerable PTE
backport-f440b31efe42.patch #   2018-08-14 17:29:09 - x86/spec-ctrl: CPUID/MSR definitions for L1D_FLUSH
backport-f05a33e327b8.patch #   2018-08-14 17:33:42 - x86/msr: Virtualise MSR_FLUSH_CMD for guests
backport-0aa4696e13be.patch #   2018-08-14 17:33:43 - x86/spec-ctrl: Introduce an option to control L1D_FLUSH for HVM HAP guests
backport-da93914cb855.patch #   2018-08-14 17:33:43 - x86: Make "spec-ctrl=no" a global disable of all mitigations
backport-7ba1c7df8818.patch #   2018-08-15 13:25:19 - x86: write to correct variable in parse_pv_l1tf()
backport-3f7b4ecfab99.patch #   2018-09-14 10:30:33 - x86/spec-ctrl: adjust backport of b76ec3946b
backport-4e69e432724c.patch #   2018-11-07 08:54:07 - x86: extend get_platform_badpages() interface
backport-3d3e474d68b1.patch #   2018-11-07 08:54:57 - x86: work around HLE host lockup erratum
backport-efe21ad4428c.patch #   2018-11-20 15:02:46 - amd/iommu: fix flush checks
backport-2b3463f77dd0.patch #   2018-11-20 15:03:32 - AMD/IOMMU: suppress PTE merging after initial table creation
backport-045d4f77e921.patch #   2018-11-20 15:04:10 - x86/mm: Don't perform flush after failing to update a guests L1e
backport-4f3858fcf002.patch #   2018-11-20 15:04:55 - x86/shadow: move OOS flag bit positions
backport-ab6d56c4cac1.patch #   2018-11-20 15:05:36 - x86/shadow: shrink struct page_info's shadow_flags to 16 bits

# Patches from master
backport-bacbf0cb7349.patch #   2016-06-08 13:04:30 - build: convert debug to Kconfig
backport-c9e5a6a232db.patch #   2016-06-08 13:09:16 - build: convert crash_debug to Kconfig
backport-212d27297af9.patch #   2016-06-08 13:09:55 - build: convert verbose to Kconfig
backport-289c53a49307.patch #   2016-06-08 13:10:35 - build: convert frame_pointer to Kconfig
backport-635c5ec3f0ee.patch #   2016-06-08 13:11:21 - build: convert perfc{,_arrays} to Kconfig
backport-eb4858721050.patch #   2016-06-08 13:13:30 - AMD IOMMU: introduce support for IVHD block type 11h
backport-ce34d6b036ed.patch #   2016-06-09 14:30:33 - xen/vsprintf: Avoid returning NULL from number()
backport-6e908ee108ca.patch #   2016-06-10 16:42:49 - xen/x86: Always print processor information at boot
backport-759b9618b8a2.patch #   2016-06-15 16:46:36 - AMD IOMMU: correctly propagate errors from amd_iommu_init()
backport-490a39a1dbc7.patch #   2016-06-21 10:59:37 - vm_event: allow subscribing to write events for specific MSR-s
backport-06f083c82683.patch #   2016-06-21 11:01:18 - x86: also generate assembler usable equates for synthesized features
backport-31689dcb0fbf.patch #   2016-06-21 14:29:17 - flask/policy: split into modules
backport-a2c8399a91bf.patch #   2016-06-21 14:29:17 - flask/policy: split out rules for system_r
backport-d72fd26d5f17.patch #   2016-06-21 14:29:17 - flask/policy: move user definitions and constraints into modules
backport-e2aba42bff72.patch #   2016-06-21 14:29:17 - flask/policy: remove unused support for binary modules
backport-2511f89d9a5e.patch #   2016-06-21 14:29:17 - flask/policy: xenstore stubdom policy
backport-b49839ef4e6b.patch #   2016-06-21 14:29:18 - flask/policy: remove unused example
backport-53c300ab1ca0.patch #   2016-06-21 14:54:27 - flask: unify {get, set}vcpucontext permissions
backport-45aa97876683.patch #   2016-06-21 14:54:46 - flask: remove unused secondary context in ocontext
backport-d18224766fa2.patch #   2016-06-21 14:55:21 - flask: remove unused AVC callback functions
backport-559f439bfa3b.patch #   2016-06-21 14:55:30 - flask: remove xen_flask_userlist operation
backport-56fef9e367b2.patch #   2016-06-21 14:56:00 - flask: improve unknown permission handling
backport-c6f7d2174780.patch #   2016-06-21 15:55:20 - xen/xsm: remove .xsm_initcall.init section
backport-ee3fd57acd90.patch #   2016-06-23 16:57:14 - xen: add warning infrastructure
backport-509019f42dd5.patch #   2016-06-23 16:57:14 - xen/console: use warning infrastructure for sync console warning
backport-a6288d5bb8b9.patch #   2016-06-23 17:00:33 - xen: make available hvm_fep to non-debug build as well
backport-6a962ebddce8.patch #   2016-06-24 14:48:14 - xen: move FLASK entry under XSM in Kconfig
backport-70dda5f4e9c9.patch #   2016-06-24 14:52:51 - xsm: annotate setup functions with __init
backport-5efcebc66de0.patch #   2016-06-24 14:53:03 - xsm: clean up unregistration
backport-668ba1f85bf2.patch #   2016-06-24 14:53:13 - xen: Make FLASK_AVC_STATS kconfig option visible
backport-7edc10831448.patch #   2016-07-08 14:33:13 - tools/xl: Allow callers of `xl info` to select specific information
backport-f755485cbd2a.patch #   2016-07-08 14:36:00 - XSM/policy: Allow the source domain access to settime and setdomainhandle domctls while creating domain.
backport-e04b562377b3.patch #   2016-07-14 15:32:31 - xsm: rework policy_buffer globals
backport-41b61be1c244.patch #   2016-07-14 15:32:38 - xsm: add a default policy to .init.data
backport-2ad72c0b4676.patch #   2016-07-14 15:50:04 - XSM-Policy: allow source domain access to setpodtarget and getpodtarget for ballooning.
backport-4ef815bf611d.patch #   2016-07-15 10:52:34 - xen/flask: Rename cond_expr.bool to bool_val
backport-920234259475.patch #   2016-07-15 10:52:36 - xen/build: Use C99 booleans
backport-e3eb84e33c36.patch #   2016-07-20 04:00:54 - xen: Add generic implementation of binary search
backport-7179cd39efdb.patch #   2016-07-27 15:34:31 - xen/domctl: Add DOMINFO_hap to xen_domctl_getdomaininfo
backport-fa74e70500fd.patch #   2016-08-03 13:40:44 - x86/time: introduce and use rdtsc_ordered()
backport-93340297802b.patch #   2016-08-04 09:02:52 - x86/time: calibrate TSC against platform timer
backport-cbfe4db8d750.patch #   2016-08-12 15:51:36 - vm_event: synchronize vCPU state in vm_event_resume()
backport-698d0f377d72.patch #   2016-09-05 11:47:46 - have __DEFINE_COMPAT_HANDLE() generate const versions
backport-c99986fa168e.patch #   2016-09-06 13:33:44 - x86/pv: Support do_set_segment_base() for compat guests
backport-51e5d6c7a296.patch #   2016-09-06 13:34:28 - x86/pv: Implement pv_hypercall() in C
backport-0831e9944612.patch #   2016-09-08 16:39:46 - x86/hvm: Perform a user instruction fetch for a FEP in userspace
backport-d45fae589b8d.patch #   2016-09-12 11:00:08 - x86/cpu: Print CPU Family/Vendor infomation in both decimal and hexidecimal
backport-1ef5056bd627.patch #   2016-09-19 16:59:42 - tools/libxc, xen/x86: Added xc_set_mem_access_multi()
backport-3a7f872ae427.patch #   2016-09-19 17:03:20 - tools: lift BUILD_BUG_ON to a tools header file
backport-424fdc67e90b.patch #   2016-09-21 13:59:52 - x86/mm: Add missing copy_from_user error checks in p2m_set_access_multi
backport-e602d666608c.patch #   2016-09-23 17:39:44 - livepach: Add .livepatch.hooks functions and test-case
backport-50a12dd59f23.patch #   2016-09-30 14:00:29 - x86/emulate: add support for {,v}movq xmm,xmm/m64
backport-4f13e5b3f69a.patch #   2016-09-30 14:01:23 - x86/emulate: add support for {,v}movd {,x}mm,r/m32 and {,v}movq {,x}mm,r/m64
backport-70c95ecd5c0e.patch #   2016-10-20 15:27:55 - x86/Intel: Expose cpuid_faulting_enabled so it can be used elsewhere
backport-4abcd521bf46.patch #   2016-10-20 15:28:07 - x86/Intel: virtualize support for cpuid faulting
backport-0897514b4b37.patch #   2016-10-26 12:37:45 - tools/oxenstored: Avoid allocating invalid transaction ids
backport-496673a2ada9.patch #   2016-10-31 21:02:08 - tools/oxenstored: Fix transaction handling in 32bit builds
backport-f948ce4371cd.patch #   2016-12-12 16:43:34 - AMD IOMMU: Support IOAPIC IDs larger than 128
backport-6a6bbedd39e3.patch #   2016-12-14 18:23:51 - x86: Use ACPI reboot method for Dell OptiPlex 9020
backport-181deca063ad.patch #   2016-12-14 20:27:19 - tools/livepatch: Show the correct expected state before action
backport-a81163ef0fca.patch #   2016-12-14 20:27:19 - tools/livepatch: Set stdout and stderr unbuffered
backport-9fae6285740a.patch #   2016-12-14 20:27:19 - tools/livepatch: Improve output
backport-3bc5cf73d72a.patch #   2016-12-14 20:27:19 - livepatch: Fix documentation of timeout
backport-4c8eab5a9349.patch #   2016-12-14 20:27:19 - tools/livepatch: Remove pointless retry loop
backport-a7e8107dbb1d.patch #   2016-12-14 20:27:19 - tools/livepatch: Remove unused struct member
backport-0265fd753b7a.patch #   2016-12-14 20:27:19 - tools/livepatch: Save errno where needed
backport-ca01e5821245.patch #   2016-12-14 20:27:19 - tools/livepatch: Exit with 2 if a timeout occurs
backport-ac6a4500b2be.patch #   2016-12-15 10:11:20 - vvmx: set vmxon_region_pa of vcpu out of VMX operation to an invalid address
backport-c88da9ec8852.patch #   2016-12-15 10:11:45 - vvmx: return VMfail to L1 if L1 vmxon is executed in VMX operation
backport-08fac63ec0b8.patch #   2016-12-15 10:12:06 - vvmx: check the operand of L1 vmxon
backport-1cb650c3191f.patch #   2016-12-20 08:51:45 - vvmx: fix the wrong address width in c/s 08fac63
backport-44d3196903f3.patch #   2016-12-20 08:53:39 - vvmx: replace vmreturn() by vmsucceed() and vmfail*()
backport-9bd6b01f9d46.patch #   2017-01-24 10:38:35 - x86/hvm: Conditionally leave CPUID Faulting active in HVM context
backport-d4a24c64b60d.patch #   2017-02-09 10:07:01 - x86/vmx: introduce vmwrite_safe()
backport-1edbf34e63c8.patch #   2017-02-09 10:07:31 - x86/vmx: improve vmread_safe()
backport-7f8445d9678a.patch #   2017-02-10 09:42:02 - common/vm_event: prevent guest locking with large max_vcpus
backport-195ca0e1de85.patch #   2017-02-14 10:25:05 - x86/vmx: introduce VMX_INSN_SUCCEED
backport-d18216a0c03c.patch #   2017-02-14 10:25:18 - x86/vvmx: correctly emulate VMWRITE
backport-62c7b99a1079.patch #   2017-02-14 10:25:27 - x86/vvmx: correctly emulate VMREAD
backport-d6e9f8d4f35d.patch #   2017-02-23 09:33:27 - x86/vmx: fix vmentry failure with TSX bits in LBR
backport-0d670cd46cb5.patch #   2017-03-22 11:02:01 - x86/mm: use statically defined locking order
backport-04f34e76ac50.patch #   2017-04-06 10:37:32 - tools/python: Adjust migration v2 library to warn about zero-content records
backport-d9eb706356ad.patch #   2017-05-25 09:59:49 - x86/hvmloader: Don't wait for the producer to fill the ring if
backport-20f1976b4419.patch #   2017-06-07 12:00:41 - x86/vmx: Fix vmentry failure because of invalid LER on Broadwell
backport-806e07eecfe3.patch #   2017-08-09 11:23:16 - common/page_alloc: Drop BOOT_BUG_ON()
backport-7c275549f46c.patch #   2017-08-10 11:34:21 - AMD IOMMU: drop amd_iommu_setup_hwdom_device()
backport-4098b092e190.patch #   2017-09-25 09:53:00 - x86/msr: introduce struct msr_domain_policy
backport-4187f79dc718.patch #   2017-09-25 09:54:09 - x86/msr: introduce struct msr_vcpu_policy
backport-e7a370733bd2.patch #   2017-09-25 09:55:23 - x86: replace arch_vcpu::cpuid_faulting with msr_vcpu_policy
backport-37f074a33831.patch #   2017-09-25 09:56:13 - x86/msr: introduce guest_rdmsr()
backport-664adc5ccab1.patch #   2017-09-25 09:56:52 - x86/msr: introduce guest_wrmsr()
backport-d73e68c08f1f.patch #   2017-09-26 10:33:35 - x86/levelling: Avoid NULL pointer dereference
backport-b90f86be161c.patch #   2017-12-01 18:09:48 - x86: Avoid corruption on migrate for vcpus using CPUID Faulting
backport-f97f774b5aa6.patch #   2018-01-24 17:01:00 - x86/shutdown: use ACPI reboot method for Dell PowerEdge R740
backport-2375832c7e51.patch #   2018-01-25 10:35:20 - xen/VT-d: Remove the use of __LINE__ from IOMMU_WAIT_OP()
backport-c93014ad3aa6.patch #   2018-02-07 17:31:13 - ocaml/libs/xb: don't generate *.mli automatically
backport-328ca55b7bd4.patch #   2018-06-28 08:29:13 - x86/shutdown: use ACPI reboot method for Dell PowerEdge R540
backport-ada9a4d904f8.patch #   2018-08-28 14:17:11 - xen/xsm: Rename CONFIG_FLASK_* to CONFIG_XSM_FLASK_*
backport-4991a46130dc.patch #   2018-08-28 14:17:11 - xen/xsm: Rename CONFIG_XSM_POLICY to CONFIG_XSM_FLASK_POLICY
backport-725cc2edce3d.patch #   2018-08-29 15:28:01 - x86: report use of PCID together with reporting XPTI status
backport-89faccfd35dd.patch #   2018-09-27 11:19:48 - tools/ocaml: Add OCaml binding of virq bind
backport-df8601938a71.patch #   2018-10-04 13:54:36 - tools/ocaml: Strip all trailing whitespace
backport-129025fe3093.patch #   2018-10-04 13:54:36 - oxenstored: Don't re-open a xenctrl handle for every domain introduction
backport-7b20a865bc10.patch #   2018-10-08 10:58:55 - tools/ocaml: Release the global lock before invoking block syscalls
backport-35cd5ba36751.patch #   2018-10-24 22:16:11 - x86/vvmx: Disallow the use of VT-x instructions when nested virt is disabled
backport-f99941871a84.patch #   2018-11-14 18:22:09 - tools/ocaml: cleanup to reduce compiler warnings

################################################################################
# Patches for upstream
#

detect-nehalem-c-state.patch # malcolmc
quirk-hp-gen8-rmrr.patch # malcolmc
quirk-pci-phantom-function-devices.patch # malcolmc
sched-credit1-use-per-pcpu-runqueue-count.patch # malcolmc

# Hpet improvements v5
0001-x86-hpet-Pre-cleanup.patch
0002-x86-hpet-Use-singe-apic-vector-rather-than-irq_descs.patch
0003-x86-hpet-Post-cleanup.patch

0002-libxc-retry-shadow-ops-if-EBUSY-is-returned.patch

# Grant perf improvements
avoid-gnt-unmap-tlb-flush-if-not-accessed.patch

# Multiboot2 + EFI (from Daniel Kiper)
0002-x86-boot-reloc-create-generic-alloc-and-copy-functio.patch
0003-x86-boot-use-ecx-instead-of-eax.patch
0004-xen-x86-add-multiboot2-protocol-support.patch
0005-efi-split-efi_enabled-to-efi_platform-and-efi_loader.patch
0007-efi-run-EFI-specific-code-on-EFI-platform-only.patch
0008-efi-build-xen.gz-with-EFI-code.patch
0017-x86-efi-create-new-early-memory-allocator.patch
0018-x86-add-multiboot2-protocol-support-for-EFI-platform.patch
mkelf32-fixup.patch
0001-x86-efi-Find-memory-for-trampoline-relocation-if-nec.patch
0002-efi-Ensure-incorrectly-typed-runtime-services-get-ma.patch
0001-Fix-compilation-on-CentOS-7.1.patch
0001-x86-time-Don-t-use-EFI-s-GetTime-call.patch
0001-efi-Workaround-page-fault-during-runtime-service.patch
efi-align-stack.patch

0001-x86-HVM-Avoid-cache-flush-operations-during-hvm_load.patch # rossla - CA-168080
0001-libxl-Don-t-insert-PCI-device-into-xenstore-for-HVM-.patch # rossla - CA-168029

# PoD extra mitigations
0001-x86-PoD-Command-line-option-to-prohibit-any-PoD-oper.patch

0001-libxl-handle-an-INVALID-domain-when-removing-a-pci-d.patch

fail-on-duplicate-symbol.patch
livepatch-ignore-duplicate-new.patch
default-log-level-info.patch

# Reduce use of __LINE__
0001-lib-Add-a-generic-implementation-of-current_text_add.patch
0002-sched-Remove-dependency-on-__LINE__-for-release-buil.patch

# btrfs support for PV guests
pygrub-Ignore-GRUB2-if-statements.patch
libfsimage-Add-support-for-btrfs.patch

0001-xen-domctl-Implement-a-way-to-retrieve-a-domains-nom.patch

quiet-broke-irq-affinity.patch # rossla

# xsm SILO
0003-xen-xsm-Introduce-new-boot-parameter-xsm.patch
0004-xen-xsm-Add-new-SILO-mode-for-XSM.patch

################################################################################
# Un-upstreamable patches
#
xen-tweak-cmdline-defaults.patch
xen-tweak-debug-overhead.patch
tweak-iommu-errata-policy.patch
disable-core-parking.patch

# Un-upstreamable hacks to make older windows VMs continue to function on newer Xen
xen-legacy-win-driver-version.patch
xen-legacy-win-xenmapspace-quirks.patch
xen-legacy-32bit_shinfo.patch
xen-legacy-process-dying.patch
xen-legacy-viridian-hypercalls.patch
xen-legacy-hvm-console.patch

0001-Allocate-space-in-structs-pre-emptively-to-increase-.patch

################################################################################
# Technical debt
#

# xen debt
livepatch-payload-in-header.patch
xen-define-offsets-for-kdump.patch
xen-scheduler-auto-privdom-weight.patch
xen-hvm-disable-tsc-ramping.patch
xen-default-cpufreq-governor-to-performance-on-intel.patch
xen-override-caching-cp-26562.patch

# libxc debt
revert-ca2eee92df44.patch # 2008-09-30 09:14:54 - x86, hvm: Expose host core/HT topology to HVM guests - needs removing in a migrate-safe way.
libxc-stubs-hvm_check_pvdriver.patch
libxc-ext-6.patch
libxc-ext-7.patch
libxc-ext-8.patch
restrict-privcmd.patch

# pygrub debt
pygrub-add-default-and-extra-args.patch
pygrub-always-boot-default.patch
pygrub-friendly-no-fs.patch
pygrub-image-max-size.patch
pygrub-default-xenmobile-kernel.patch
pygrub-blacklist-support.patch

# BIOS debt
oem-bios-xensource.patch # Can probably all be discarded
oem-bios-magic-from-xenstore.patch # Need to tweak, but should be upstreamed

# misc debt
misc-log-guest-consoles.patch
fix-ocaml-libs.patch
ocaml-cpuid-helpers.patch

# xentop debt
xentop-display-correct-stats.patch
xentop-vbd3.patch

# mixed between components
mixed-domain-runstates.patch
mixed-xc-sockets-per-core.patch
xenguest.patch
xen-vmdebug.patch
local-xen-vmdebug.patch

oxenstore-update.patch
oxenstore-censor-sensitive-data.patch
oxenstore-large-packets.patch

# vGPU
nvidia-hypercalls.patch
nvidia-vga.patch

# workspace pod debt
hvmloader-disable-pci-option-rom-loading.patch

# Nested virt tweaking knobs
xen-force-software-vmcs-shadow.patch

# Intel GPU passthrough debt - future GPU driver changes will obsolete patch
# Patch is required to allow Cream to Dundee upgrade
igd_passthru.patch
allow-rombios-pci-config-on-any-host-bridge.patch
add-p2m-write-dm-to-ram-types.patch
add-pv-iommu-headers.patch
add-iommu-lookup-core.patch
add-iommu-lookup-intel.patch
add-pv-iommu-local-domain-ops.patch
add-pv-iommu-foreign-support.patch
upstream-pv-iommu-tools.patch

# Intel GVT-g debt
0007-hypercall-XENMEM_get_mfn_from_pfn.patch # Remove when PV-IOMMU code merged
0012-resize-MAX_NR_IO_RANGES-to-512.patch # Replace with list discussed version when merged
0015-xen-introduce-unlimited-rangeset.patch # Replace with list discussed version when merged
0016-ioreq-server-allocate-unlimited-rangeset-for-memory-.patch # Replace with list discussed version when merged
gvt-g-hvmloader+rombios.patch # Intel to upstream
revert-c858e932c1dd.patch # Reinstate HVMMEM_mmio_write_dm

# VM Introspection Extensions
xen-introduce-cmdline-to-control-introspection-extensions.patch
xen-domctl-set-privileged-domain.patch
xen-x86-hvm-Allow-guest_request-vm_events-coming-from-us.patch
x86-domctl-Don-t-pause-the-whole-domain-if-only-gett.patch
xen-reexecute-instn-under-monitor-trap.patch
xen-x86-emulate-syncrhonise-LOCKed-instruction-emulation.patch
xen-emulate-Bypass-the-emulator-if-emulation-fails.patch
xen-introspection-pause.patch
0001-x86-vm_event-Added-support-for-VM_EVENT_REASON_INTER.patch
0002-mem_access-sanitize-code-around-sending-vm_event-req.patch
xen-vm_event-fix-race-between-vmx_vmexit_handler-and.patch
0001-x86-the-in_host-property-should-be-set-to-true-when-.patch
xen-introspection-elide-cr4-pge.patch

# XSM
xen-xsm-default-policy.patch
xen-xsm-allow-access-unlabeled-resources.patch
xen-xsm-treat-unlabeled-domain-domU.patch

# Common Criteria
0001-cc-memory-scrubbing.patch

################################################################################
# Hotfix patches
#
0001-Revert-x86-HVM-don-t-give-the-wrong-impression-of-WR.patch
0001-VMX-allow-migration-of-guests-with-SSBD-enabled.patch
backport-5ac2dddb173b.patch #   2019-01-09 14:45:14 - mm/page_alloc: fix MEMF_no_dma allocations for single NUMA
backport-c393b64dcee6.patch #   2018-11-30 14:21:12 - tools/libxc: Fix issues with libxc and Xen having different featureset lengths
backport-82855aba5bf9.patch #   2018-11-30 14:21:12 - tools/libxc: Fix error handling in get_cpuid_domain_info()

xsa283.patch # IOMMU/VT-d: Correct the calculation of which IRTE to use
xsa284.patch # gnttab: set page refcount for copy-on-grant-transfer
xsa285-4.11.patch # IOMMU/x86: fix type ref-counting race upon IOMMU page table construction
xsa287-4.7.patch # steal_page: Get rid of bogus struct page states
xsa288-4.7.patch # xen: Make coherent PV IOMMU discipline
xsa290-4.7-1.patch # x86/mm: also allow L2 (un)validation to be preemptible
xsa290-4.7-2.patch # x86/mm: add explicit preemption checks to L3 (un)validation
xsa292.patch # x86/mm: properly flush TLB in switch_cr3_cr4()
xsa293-4.7-1.patch # x86/pv: Improve pv_cpuid()'s API
xsa293-4.7-2.patch # x86/pv: Rewrite guest %cr4 handling from scratch
xsa293-4.7-3.patch # x86/pv: Don't have %cr4.fsgsbase active behind a guest kernels back
backport-69d99d1b223f.patch #   2017-08-30 11:02:24 - x86/pt: add a MSI unmask flag to XEN_DOMCTL_bind_pt_irq
xsa294-4.7.patch # x86/pv: _toggle_guest_pt() may not skip TLB flush for shadow mode guests

backport-9062fd6bfa52.patch #   2016-06-09 14:51:43 - mwait-idle: add SKX support
backport-1008063e1cd1.patch #   2016-06-09 14:52:05 - mwait-idle: add KBL support
backport-a6c60019fd2e.patch #   2016-06-09 14:52:27 - mwait-idle: add BXT support
backport-372ad59dd0e7.patch #   2016-06-09 14:52:56 - mwait-idle: add a missing __init annotation
backport-feb7747be7fa.patch #   2016-08-01 17:21:37 - mwait-idle: correct/improve BXT support
backport-a33c2a9a7831.patch #   2016-08-03 13:41:13 - mwait-idle: add Denverton
backport-350bc1a9d4eb.patch #   2016-08-04 09:52:49 - x86: support newer Intel CPU models
backport-6bd621d7010b.patch #   2016-09-19 10:42:23 - x86/Intel: Broadwell doesn't have PKG_C{8,9,10}_RESIDENCY MSRs
backport-b4a30d648b65.patch #   2017-01-04 13:29:08 - x86/mwait-idle: add CPU model 0x4a (Atom Z34xx series)
backport-c585f9f0da80.patch #   2017-01-04 13:29:30 - x86/mwait-idle: add Knights Mill CPUID
backport-c0bac61bb422.patch #   2017-09-18 11:25:32 - VMX: convert CPU family numbers to hex
backport-9d6803250243.patch #   2017-09-18 11:26:22 - VMX: add new CPU families to LBR handling
backport-aba97792a8c5.patch #   2017-09-18 11:27:06 - x86/cpuidle: add new CPU families
backport-4e131596f1de.patch #   2018-03-20 10:21:58 - x86/mwait-idle: add Gemini Lake support
backport-ff9b9d540f1b.patch #   2019-01-21 11:13:22 - x86/vm_event: block interrupt injection for sync vm_events
backport-e64f22df3c1a.patch #   2016-08-11 10:09:21 - x86/microcode: Avoid undefined behaviour from signed integer overflow
backport-b95028e468f7.patch #   2017-03-02 15:53:01 - x86/microcode: Replace sync_core() with cpuid_eax()
backport-24882b38d640.patch #   2018-02-16 13:33:13 - x86/microcode: Propagate microcode update errors
# v6 late ucode series from Chao Gao (Intel)
0001-misc-xenmicrocode-Upload-a-microcode-blob-to-the-hyp.patch
0002-microcode-intel-use-union-to-get-fields-without-shif.patch
0003-microcode-intel-extend-microcode_update_match.patch
0004-microcode-introduce-a-global-cache-of-ucode-patch.patch
0005-microcode-only-save-compatible-ucode-patches.patch
0006-microcode-remove-struct-ucode_cpu_info.patch
0007-microcode-remove-pointless-cpu-parameter.patch
0008-microcode-split-out-apply_microcode-from-cpu_request.patch
0009-microcode-remove-struct-microcode_info.patch
0010-microcode-intel-Writeback-and-invalidate-caches-befo.patch
0011-x86-microcode-Synchronize-late-microcode-loading.patch
0012-microcode-update-microcode-on-cores-in-parallel.patch
# local fixes/changes (to be applied onto v7)
0001-microcode-fix-ucode-application-on-AMD.patch
0002-microcode-rename-tool-to-xen-microcode.patch
0003-xen-microcode-add-information-about-currently-loaded.patch
0004-microcode-add-sequential-application-policy.patch
0005-microcode-remove-STEPPING_MASK.patch
0006-microcode-simplify-ucode-caching.patch
0007-microcode-update-raw-cpuid-policy-after-a-successful.patch
0008-microcode-collect_cpu_info-during-early_microcode_in.patch
0001-microcode-remove-panic-calls.patch
# Live microcode loading additions
0001-x86-add-XEN_SYSCTL_spec_ctrl.patch
0002-x86-add-xen-spec-ctrl-utility.patch
backport-fc46e159a6b1.patch #   2019-03-18 16:08:25 - x86/tsx: Implement controls for RTM force-abort mode
backport-ffb60a58df48.patch #   2018-11-01 10:20:34 - tools/misc/xenpm: fix getting info when some CPUs are offline
# HT boot-time detection
0001-x86-spec-ctrl-Reposition-the-XPTI-command-line-parsi.patch
0002-x86-msr-Definitions-for-MSR_INTEL_CORE_THREAD_COUNT.patch
0003-x86-boot-Detect-the-firmware-SMT-setting-correctly-o.patch
xsa297-4.7-1.patch
xsa297-4.7-2.patch
xsa297-4.7-3.patch
xsa297-4.7-4.patch
# vCPU migration race mitigation
0001-xen-Introduce-vcpu_sleep_nosync_locked.patch
0002-xen-schedule-Fix-races-in-vcpu-migration.patch

backport-56ad626532eb.patch #   2019-07-02 12:00:42 - x86/msi: fix loop termination condition in pci_msi_conf_write_intercept()
# custom smbios type 2
0001-hvmloader-add-SMBIOS-type-2-info-for-customized-stri.patch
backport-902888922e6f.patch #   2019-06-28 13:17:53 - x86/cpuid: leak OSXSAVE only when XSAVE is not clear in policy
0001-xsm-hide-detailed-Xen-version-from-unprivileged-gues.patch
backport-63d71138a4d3.patch #   2019-02-01 10:31:28 - x86/VT-x: Don't activate VMCS Shadowing outside of nested vmx mode
0001-IOMMU-add-missing-HVM-check.patch
0002-passthrough-quarantine-PCI-devices.patch
xsa296-4.8.patch
xsa298-4.9.patch
xsa299-4.80001-x86-mm-Clean-up-trailing-whitespace.patch
xsa299-4.80002-x86-mm-L1TF-checks-don-t-leave-a-partial-entry.patch
xsa299-4.80003-x86-mm-Don-t-re-set-PGT_pinned-on-a-partially-de-val.patch
xsa299-4.80004-x86-mm-Separate-out-partial_pte-tristate-into-indivi.patch
xsa299-4.80005-x86-mm-Use-flags-for-_put_page_type-rather-than-a-bo.patch
xsa299-4.80006-x86-mm-Rework-get_page_and_type_from_mfn-conditional.patch
xsa299-4.80007-x86-mm-Have-alloc_l-23-_table-clear-partial_flags-wh.patch
xsa299-4.80008-x86-mm-Always-retain-a-general-ref-on-partial.patch
xsa299-4.80009-x86-mm-Collapse-PTF_partial_set-and-PTF_partial_gene.patch
xsa299-4.80010-x86-mm-Properly-handle-linear-pagetable-promotion-fa.patch
xsa299-4.80011-x86-mm-Fix-nested-de-validation-on-error.patch
xsa299-4.80012-x86-mm-Don-t-drop-a-type-ref-unless-you-held-a-ref-t.patch
backport-b68c4f1ebe4f.patch #   2018-02-28 17:56:24 - x86/hvm: fix domain crash when CR3 has the noflush bit set
backport-b144cf45d50b.patch #   2019-05-31 10:40:52 - x86/vhpet: avoid 'small' time diff test on resume
xsa304-4.7-1.patch # x86/vtd: Hide superpage support for SandyBridge IOMMUs
xsa304-4.7-2.patch # x86/vtx: Disable executable EPT superpages to work around CVE-2018-12207
xsa304-fast-by-default.patch
xsa304-runtime-control.patch
xsa305-4.7-1.patch # x86/tsx: Introduce tsx= to use MSR_TSX_CTRL when available
xsa305-4.7-2.patch # x86/spec-ctrl: Mitigate the TSX Asynchronous Abort sidechannel
toolstack-tsx-ctrl.patch
xsa305-leave-tsx-visible.patch
xsa305-runtime-control.patch
xsa308.patch
backport-77beba7c921a.patch #   2019-11-25 10:58:27 - x86/mm: Adjust linear uses / entries when a page loses validation
xsa309.patch
xsa310-4.9-0001-x86-mm-Set-old_guest_table-when-destroying-vcpu-page.patch
xsa310-4.9-0002-x86-mm-alloc-free_lN_table-Retain-partial_flags-on-E.patch
xsa310-4.9-0003-x86-mm-relinquish_memory-Grab-an-extra-type-ref-when.patch
xsa311-4.8-1.patch
xsa311-4.8-2.patch
backport-5e08f5f56c99.patch #   2020-01-29 14:06:10 - x86/suspend: disable watchdog before calling console_start_sync()
xsa313-1.patch
xsa313-2.patch
backport-7442006b9f09.patch #   2019-12-11 13:06:18 - x86+Arm32: make find_next_{,zero_}bit() have well defined behavior
xsa316-2.patch
0001-x86-spec-ctrl-CPUID-MSR-definitions-for-Special-Regi.patch # XSA-320 / SRBDS
0002-x86-spec-ctrl-Mitigate-the-Special-Register-Buffer-D.patch # XSA-320 / SRBDS
xsa320-xsa320-4.9-3.patch # XSA-320 v2 / SRBDS
xsa328-xsa328-4.9-1.patch
xsa328-xsa328-4.9-2.patch
xsa321-xsa321-4.9-1.patch
xsa321-xsa321-4.9-2.patch
xsa321-xsa321-4.9-3.patch
xsa321-xsa321-4.9-4.patch
xsa321-xsa321-4.9-5.patch
xsa321-xsa321-4.9-6.patch
xsa321-xsa321-4.9-7.patch
xsa336.patch # x86/vpt: fix race when migrating timers between vCPUs
xsa337xsa337-4.12-1.patch # x86/msi: get rid of read_msi_msg
xsa337xsa337-4.12-2.patch # x86/MSI-X: restrict reading of table/PBA bases from BAR
xsa338.patch # evtchn: relax port_is_valid()
xsa339.patch # x86/pv: Avoid double exception injection
xsa340.patch # xen/evtchn: Add missing barriers when accessing/allocating an event channel
xsa342-4.13.patch # evtchn/x86: enforce correct upper limit for 32-bit guests
xsa343xsa343-4.10-1.patch # evtchn: evtchn_reset() shouldn't succeed with still-open ports
xsa343xsa343-4.10-2.patch # evtchn: convert per-channel lock to be IRQ-safe
xsa343xsa343-4.10-3.patch # evtchn: address races with evtchn_reset()
xsa344xsa344-4.10-1.patch # evtchn: arrange for preemption in evtchn_destroy()
xsa344xsa344-4.10-2.patch # evtchn: arrange for preemption in evtchn_reset()
0001-evtchn-don-t-call-Xen-consumer-callback-with-per-cha.patch
xsa345-4.100001-x86-mm-Refactor-map_pages_to_xen-to-have-only-a-sing.patch
xsa345-4.100002-x86-mm-Refactor-modify_xen_mappings-to-have-one-exit.patch
xsa345-4.100003-x86-mm-Prevent-some-races-in-hypervisor-mapping-upda.patch
xsa346xsa346-4.10-1.patch # IOMMU: suppress "iommu_dont_flush_iotlb" when about to free a page
xsa346xsa346-4.10-2.patch # IOMMU: hold page ref until after deferred TLB flush
xsa347xsa347-4.11-1.patch # AMD/IOMMU: update live PTEs atomically
xsa347xsa347-4.11-2.patch # AMD/IOMMU: ensure suitable ordering of DTE modifications
xsa351-x86-4.7.6-1.patch # x86/msr: fix handling of MSR_IA32_PERF_{STATUS/CTL}
xsa351-x86-4.7.6-2.patch # x86/msr: Disallow guest access to the RAPL MSRs
backport-2012db463b8b.patch #   2020-10-27 18:08:23 - x86/pv: Drop FLUSH_TLB_GLOBAL in do_mmu_update() for XPTI
backport-78d903e95efc.patch #   2020-10-27 18:10:12 - x86/pv: Flush TLB in response to paging structure changes
xsa355.patch # memory: fix off-by-one in XSA-346 change
xsa353.patch # tools/ocaml/xenstored: do permission checks on xenstore root
xsa115-4.7-0001-tools-ocaml-xenstored-ignore-transaction-id-for-un-w.patch
xsa115-4.7-0002-tools-ocaml-xenstored-check-privilege-for-XS_IS_DOMA.patch
xsa115-4.7-0003-tools-ocaml-xenstored-unify-watch-firing.patch
xsa115-4.7-0004-tools-ocaml-xenstored-introduce-permissions-for-spec.patch
xsa115-4.7-0005-tools-ocaml-xenstored-avoid-watch-events-for-nodes-w.patch
xsa115-4.7-0006-tools-ocaml-xenstored-add-xenstored.conf-flag-to-tur.patch
xsa322-o.patch # tools/ocaml/xenstored: clean up permissions for dead domains
xsa323.patch # tools/ocaml/xenstored: Fix path length validation
xsa330.patch # tools/ocaml/xenstored: delete watch from trie too when resetting
xsa352.patch # tools/ocaml/xenstored: only Dom0 can change node owner
backport-ab914e04a627.patch #   2017-02-17 14:51:03 - x86: package up context switch hook pointers
xsa348-4.10.patch # x86: avoid calling {svm,vmx}_do_resume()
xsa358.patch # evtchn/FIFO: re-order and synchronize (with) map_control_block()
xsa359.patch # evtchn/FIFO: add 2nd smp_rmb() to evtchn_fifo_word_from_port()
