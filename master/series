#
# XenServer patch queue on top of xen.git
#    Upstream at git://xenbits.xen.org/xen.git
#
# In an effort to reduce future work of upgrading Xen versions, all patches in
# this queue require a justification as to why they can't/won't be upstreamed,
# with the implication that everything else should be upstreamed.
#
# If in any doubt, the ring0 patch queue maintainer will be happy to help.
#
# All patches should follow the guidelines listed here:
#       http://wiki.xen.org/wiki/Submitting_Xen_Patches
# in particular with respect to a description and S-o-b lines, with the
# exception of temporary debugging patches, which should contain at least a CA
# reference.
#
# Overview of sections:
# * XenServer build system integration.
#       **Minimal Upstream makefile hacks**
# * Upstream patches.
#       Verbatim patches from upstream, possibly with tweaks because of backporting
# * Patches for upstream.
#       Most patches should be in this section, especially new ones.  By using
#       this section, you are assuming responsibility for getting the patches
#       included upstream, and will be periodically chased by the patch queue
#       maintainer.
# * Un-upstreamable patches.
#       Default tweaks, etc.  Should be minimal.
# * Technical debt.
#       Legacy patches brought forward from the past.  This section should
#       never increase, and should progressively decrease.  **Remove when empty**
# * Debugging patches.
#       Temporary debugging patches, which must contain a CA reference.  Before
#       closing a ticket, you are expected to remove debugging patches.

################################################################################
# XenServer build system integration
#
build-disable-qemu-trad.patch # Disable the qemu trad build while still letting the tools think it exists
build-tweaks.patch # Tweak version string, start-of-day banner and changeset
disable-efi.patch
autoconf-libjson.patch

configure-build.patch # Configuration files for the build, including cached ./configure
builder-makefiles.patch # XS Makefile and Spec file
changeset-info.patch
xenserver-configuration.patch
coverity-model.patch

################################################################################
# Upstream patches
#
# Naming scheme: backport-<12 digit SHA>.patch # [*] <UTC TIMESTAMP> - <Commit subject>
#   A '*' indicates a patch which should be suggested for backport upstream

# Patches from stable-4.7
backport-087369973214.patch #   2018-07-30 13:06:44 - cmdline: fix parse_boolean() for NULL incoming end pointer
backport-dc111e9f0d99.patch #   2018-07-30 13:08:08 - xen: Port the array_index_nospec() infrastructure from Linux
backport-a4041364c3ae.patch #   2018-07-30 13:08:42 - x86/spec-ctrl: command line handling adjustments
backport-9858a1f3fb9a.patch #   2018-07-30 13:09:19 - allow cpu_down() to be called earlier
backport-c0e854be515b.patch #   2018-07-30 13:09:57 - cpupools: fix state when downing a CPU failed
backport-e90e2431a4ae.patch #   2018-07-30 13:10:30 - x86/AMD: distinguish compute units from hyper-threads
backport-97aff087fd0b.patch #   2018-07-30 13:10:58 - x86: distinguish CPU offlining from CPU removal
backport-fa807e2ff69d.patch #   2018-07-30 13:11:42 - x86: possibly bring up all CPUs even if not all are supposed to be used
backport-bce2dd64b52e.patch #   2018-07-30 13:12:39 - x86: command line option to avoid use of secondary hyper-threads
backport-91ca84c862b1.patch #   2018-07-30 13:13:09 - x86/spec-ctrl: Fix the parsing of xpti= on fixed Intel hardware

# Patches from master
backport-bacbf0cb7349.patch #   2016-06-08 13:04:30 - build: convert debug to Kconfig
backport-c9e5a6a232db.patch #   2016-06-08 13:09:16 - build: convert crash_debug to Kconfig
backport-212d27297af9.patch #   2016-06-08 13:09:55 - build: convert verbose to Kconfig
backport-289c53a49307.patch #   2016-06-08 13:10:35 - build: convert frame_pointer to Kconfig
backport-635c5ec3f0ee.patch #   2016-06-08 13:11:21 - build: convert perfc{,_arrays} to Kconfig
backport-cd42ccb27f4e.patch #   2016-06-08 13:12:45 - kexec: allow relaxed placement specification via command line
backport-eb4858721050.patch #   2016-06-08 13:13:30 - AMD IOMMU: introduce support for IVHD block type 11h
backport-ce34d6b036ed.patch #   2016-06-09 14:30:33 - xen/vsprintf: Avoid returning NULL from number()
backport-6e908ee108ca.patch #   2016-06-10 16:42:49 - xen/x86: Always print processor information at boot
backport-759b9618b8a2.patch #   2016-06-15 16:46:36 - AMD IOMMU: correctly propagate errors from amd_iommu_init()
backport-490a39a1dbc7.patch #   2016-06-21 10:59:37 - vm_event: allow subscribing to write events for specific MSR-s
backport-06f083c82683.patch #   2016-06-21 11:01:18 - x86: also generate assembler usable equates for synthesized features
backport-31689dcb0fbf.patch #   2016-06-21 14:29:17 - flask/policy: split into modules
backport-a2c8399a91bf.patch #   2016-06-21 14:29:17 - flask/policy: split out rules for system_r
backport-d72fd26d5f17.patch #   2016-06-21 14:29:17 - flask/policy: move user definitions and constraints into modules
backport-e2aba42bff72.patch #   2016-06-21 14:29:17 - flask/policy: remove unused support for binary modules
backport-2511f89d9a5e.patch #   2016-06-21 14:29:17 - flask/policy: xenstore stubdom policy
backport-b49839ef4e6b.patch #   2016-06-21 14:29:18 - flask/policy: remove unused example
backport-53c300ab1ca0.patch #   2016-06-21 14:54:27 - flask: unify {get, set}vcpucontext permissions
backport-45aa97876683.patch #   2016-06-21 14:54:46 - flask: remove unused secondary context in ocontext
backport-d18224766fa2.patch #   2016-06-21 14:55:21 - flask: remove unused AVC callback functions
backport-559f439bfa3b.patch #   2016-06-21 14:55:30 - flask: remove xen_flask_userlist operation
backport-56fef9e367b2.patch #   2016-06-21 14:56:00 - flask: improve unknown permission handling
backport-c6f7d2174780.patch #   2016-06-21 15:55:20 - xen/xsm: remove .xsm_initcall.init section
backport-ee3fd57acd90.patch #   2016-06-23 16:57:14 - xen: add warning infrastructure
backport-509019f42dd5.patch #   2016-06-23 16:57:14 - xen/console: use warning infrastructure for sync console warning
backport-a6288d5bb8b9.patch #   2016-06-23 17:00:33 - xen: make available hvm_fep to non-debug build as well
backport-6a962ebddce8.patch #   2016-06-24 14:48:14 - xen: move FLASK entry under XSM in Kconfig
backport-70dda5f4e9c9.patch #   2016-06-24 14:52:51 - xsm: annotate setup functions with __init
backport-5efcebc66de0.patch #   2016-06-24 14:53:03 - xsm: clean up unregistration
backport-668ba1f85bf2.patch #   2016-06-24 14:53:13 - xen: Make FLASK_AVC_STATS kconfig option visible
backport-7edc10831448.patch #   2016-07-08 14:33:13 - tools/xl: Allow callers of `xl info` to select specific information
backport-f755485cbd2a.patch #   2016-07-08 14:36:00 - XSM/policy: Allow the source domain access to settime and setdomainhandle domctls while creating domain.
backport-e04b562377b3.patch #   2016-07-14 15:32:31 - xsm: rework policy_buffer globals
backport-41b61be1c244.patch #   2016-07-14 15:32:38 - xsm: add a default policy to .init.data
backport-2ad72c0b4676.patch #   2016-07-14 15:50:04 - XSM-Policy: allow source domain access to setpodtarget and getpodtarget for ballooning.
backport-4ef815bf611d.patch #   2016-07-15 10:52:34 - xen/flask: Rename cond_expr.bool to bool_val
backport-920234259475.patch #   2016-07-15 10:52:36 - xen/build: Use C99 booleans
backport-e3eb84e33c36.patch #   2016-07-20 04:00:54 - xen: Add generic implementation of binary search
backport-7179cd39efdb.patch #   2016-07-27 15:34:31 - xen/domctl: Add DOMINFO_hap to xen_domctl_getdomaininfo
backport-fa74e70500fd.patch #   2016-08-03 13:40:44 - x86/time: introduce and use rdtsc_ordered()
backport-93340297802b.patch #   2016-08-04 09:02:52 - x86/time: calibrate TSC against platform timer
backport-350bc1a9d4eb.patch #   2016-08-04 09:52:49 - x86: support newer Intel CPU models
backport-cbfe4db8d750.patch #   2016-08-12 15:51:36 - vm_event: synchronize vCPU state in vm_event_resume()
backport-dcf22aa0dc08.patch #   2016-08-31 16:37:37 - xen: fix gcov compilation
backport-db6c2264e698.patch #   2016-08-31 16:37:47 - xen: add a gcov Kconfig option
backport-b942c31bc1d4.patch #   2016-09-05 11:46:13 - x86/cpuid: AVX-512 feature detection
backport-698d0f377d72.patch #   2016-09-05 11:47:46 - have __DEFINE_COMPAT_HANDLE() generate const versions
backport-3adef8e3270f.patch #   2016-09-06 09:17:46 - mem_access: sanitize code around sending vm_event request
backport-939ba61bd376.patch #   2016-09-06 13:33:44 - x86/hypercall: Move some of the hvm hypercall infrastructure into hypercall.h
backport-c99986fa168e.patch #   2016-09-06 13:33:44 - x86/pv: Support do_set_segment_base() for compat guests
backport-5464f1210c63.patch #   2016-09-06 13:33:44 - x86/hypercall: Move the hypercall arg tables into C
backport-51e5d6c7a296.patch #   2016-09-06 13:34:28 - x86/pv: Implement pv_hypercall() in C
backport-222560eb0d0e.patch #   2016-09-06 13:34:46 - x86/hypercall: Move the hypercall tables into C
backport-de82feebf2c1.patch #   2016-09-06 13:34:55 - xen/multicall: Rework arch multicall handling (rebase)
backport-d6d67b0475a1.patch #   2016-09-06 13:34:55 - x86/pv: Merge the pv hypercall tables
backport-e30c8a11a9e8.patch #   2016-09-06 13:36:05 - x86/hypercall: Merge the hypercall arg tables
backport-5c7716379ee2.patch #   2016-09-06 13:36:10 - x86/hypercall: Reduce the size of the hypercall tables
backport-8695b556205f.patch #   2016-09-07 07:30:03 - xen: indicate gcov in log messages
backport-afb118e71967.patch #   2016-09-07 07:30:03 - gcov: collect more sections to constructor list
backport-12b3174d945b.patch #   2016-09-07 07:30:03 - xen: replace TEST_COVERAGE with CONFIG_GCOV
backport-d6be2cfccfff.patch #   2016-09-07 07:30:03 - xen: make clear gcov support limitation in Kconfig
backport-0831e9944612.patch #   2016-09-08 16:39:46 - x86/hvm: Perform a user instruction fetch for a FEP in userspace
backport-d45fae589b8d.patch #   2016-09-12 11:00:08 - x86/cpu: Print CPU Family/Vendor infomation in both decimal and hexidecimal
backport-6bd621d7010b.patch #   2016-09-19 10:42:23 - x86/Intel: Broadwell doesn't have PKG_C{8,9,10}_RESIDENCY MSRs
backport-1ef5056bd627.patch #   2016-09-19 16:59:42 - tools/libxc, xen/x86: Added xc_set_mem_access_multi()
backport-3a7f872ae427.patch #   2016-09-19 17:03:20 - tools: lift BUILD_BUG_ON to a tools header file
backport-f1446de4ba52.patch #   2016-09-19 17:03:46 - libs/gnttab: introduce grant copy interface
backport-424fdc67e90b.patch #   2016-09-21 13:59:52 - x86/mm: Add missing copy_from_user error checks in p2m_set_access_multi
backport-e3b002f842c0.patch #   2016-09-29 11:04:33 - x86emul: add EVEX decoding
backport-50a12dd59f23.patch #   2016-09-30 14:00:29 - x86/emulate: add support for {,v}movq xmm,xmm/m64
backport-4f13e5b3f69a.patch #   2016-09-30 14:01:23 - x86/emulate: add support for {,v}movd {,x}mm,r/m32 and {,v}movq {,x}mm,r/m64
backport-70c95ecd5c0e.patch #   2016-10-20 15:27:55 - x86/Intel: Expose cpuid_faulting_enabled so it can be used elsewhere
backport-4abcd521bf46.patch #   2016-10-20 15:28:07 - x86/Intel: virtualize support for cpuid faulting
backport-a0e98991b040.patch #   2016-11-04 14:06:47 - tools/libxc: Add xstate cpuid leaf of avx512
backport-7cae6b6eb743.patch #   2016-11-04 15:08:21 - libxl: set ret in the check for nestedhvm and altp2m
backport-a0b421617935.patch #   2016-12-02 12:56:38 - x86/cpuid: Add AVX512_4VNNIW and AVX512_4FMAPS support
backport-f948ce4371cd.patch #   2016-12-12 16:43:34 - AMD IOMMU: Support IOAPIC IDs larger than 128
backport-6a6bbedd39e3.patch #   2016-12-14 18:23:51 - x86: Use ACPI reboot method for Dell OptiPlex 9020
backport-9864841914c2.patch #   2016-12-15 10:09:03 - x86/vm_event: add support for VM_EVENT_REASON_INTERRUPT
backport-ac6a4500b2be.patch #   2016-12-15 10:11:20 - vvmx: set vmxon_region_pa of vcpu out of VMX operation to an invalid address
backport-c88da9ec8852.patch #   2016-12-15 10:11:45 - vvmx: return VMfail to L1 if L1 vmxon is executed in VMX operation
backport-08fac63ec0b8.patch #   2016-12-15 10:12:06 - vvmx: check the operand of L1 vmxon
backport-1cb650c3191f.patch #   2016-12-20 08:51:45 - vvmx: fix the wrong address width in c/s 08fac63
backport-44d3196903f3.patch #   2016-12-20 08:53:39 - vvmx: replace vmreturn() by vmsucceed() and vmfail*()
backport-bc1e0ea329ec.patch #   2017-01-10 10:21:15 - x86/cpuid: Add AVX512_VPOPCNTDQ support
backport-90051a4ce585.patch #   2017-01-16 17:30:31 - tools/misc: add AVX512 vpopcntdq in xen-cpuid.c
backport-9bd6b01f9d46.patch #   2017-01-24 10:38:35 - x86/hvm: Conditionally leave CPUID Faulting active in HVM context
backport-524a98c2ac5e.patch #   2017-01-25 09:40:51 - public / x86: introduce __HYPERCALL_dm_op...
backport-a2323df5f47c.patch #   2017-01-25 09:41:35 - dm_op: convert HVMOP_*ioreq_server*
backport-86ad4d054a08.patch #   2017-01-25 09:43:14 - dm_op: convert HVMOP_track_dirty_vram
backport-7b2e218fd6eb.patch #   2017-01-25 09:44:50 - dm_op: convert HVMOP_set_pci_intx_level, HVMOP_set_isa_irq_level, and...
backport-b30c5979e02c.patch #   2017-01-25 09:47:13 - dm_op: convert HVMOP_modified_memory
backport-ae20ccf070bc.patch #   2017-01-25 09:48:25 - dm_op: convert HVMOP_set_mem_type
backport-58cbc034dc62.patch #   2017-01-25 09:49:52 - dm_op: convert HVMOP_inject_trap and HVMOP_inject_msi
backport-9b7c0ce58396.patch #   2017-01-25 09:51:10 - x86/hvm: serialize trap injecting producer and consumer
backport-f71628bc1593.patch #   2017-01-26 17:23:40 - flask: fix build after the introduction of DMOP
backport-7581a378b0b8.patch #   2017-01-30 11:07:48 - tools/libxc: Fix missing va_end() in do_dm_op() error path
backport-5a77ccf609da.patch #   2017-01-30 12:03:55 - xsm: Permit dom0 to use dmops
backport-8844ed299a88.patch #   2017-02-01 16:50:39 - x86/dmop: Fix compat_dm_op() ABI
backport-04dbb7109614.patch #   2017-02-08 17:45:50 - x86/p2m: Stop other vcpus using a nested p2m before clearing it
backport-d4a24c64b60d.patch #   2017-02-09 10:07:01 - x86/vmx: introduce vmwrite_safe()
backport-1edbf34e63c8.patch #   2017-02-09 10:07:31 - x86/vmx: improve vmread_safe()
backport-7f8445d9678a.patch #   2017-02-10 09:42:02 - common/vm_event: prevent guest locking with large max_vcpus
backport-195ca0e1de85.patch #   2017-02-14 10:25:05 - x86/vmx: introduce VMX_INSN_SUCCEED
backport-d18216a0c03c.patch #   2017-02-14 10:25:18 - x86/vvmx: correctly emulate VMWRITE
backport-62c7b99a1079.patch #   2017-02-14 10:25:27 - x86/vvmx: correctly emulate VMREAD
backport-78da0c2a7a9c.patch #   2017-02-20 16:53:27 - libxc: don't pass uninitialized data to do_dm_op()
backport-9b93c6b3695b.patch #   2017-02-23 09:33:25 - x86/vmx: introduce vmx_find_msr()
backport-7f11aa4b2b1f.patch #   2017-02-23 09:33:26 - x86/vmx: optimize vmx_read/write_guest_msr()
backport-d6e9f8d4f35d.patch #   2017-02-23 09:33:27 - x86/vmx: fix vmentry failure with TSX bits in LBR
backport-b108240265de.patch #   2017-02-23 11:56:28 - tools/libxendevicemodel: introduce the new library
backport-6902cb00e031.patch #   2017-02-23 11:57:40 - tools/libxendevicemodel: extract functions and add a compat layer
backport-e7745d8ef588.patch #   2017-02-23 11:57:47 - tools/libxendevicemodel: introduce a Linux-specific implementation
backport-8ef5f344d061.patch #   2017-02-23 11:57:51 - tools/libxendevicemodel: add a call to restrict the handle
backport-9442404b91be.patch #   2017-02-23 12:24:18 - tools/libxendevicemodel: Add headers.chk to .gitignore
backport-e318fa314550.patch #   2017-02-23 15:59:36 - libs/devicemodel: initialise op_bufs in xendevicemodel_xcall
backport-f68c7c618a3a.patch #   2017-02-27 16:33:56 - libs/devicemodel: free xencall handle in error path in _open()
backport-77751ed79e3c.patch #   2017-03-01 09:30:32 - x86/hvm: check HAP before enabling nested VMX
backport-a013e1b9e95e.patch #   2017-03-03 10:58:47 - x86/vvmx: check vmcs address in vmread/vmwrite
backport-e3f64938272e.patch #   2017-03-03 10:59:22 - x86/vvmx: add vmcs id check into vmptrld emulation
backport-7ecd11c90a13.patch #   2017-03-14 11:24:38 - x86/vvmx: add mov-ss blocking check to vmentry
backport-b4f98dc0d82c.patch #   2017-03-14 14:12:42 - tools: fix typo in tools/Rules.mk
backport-0d670cd46cb5.patch #   2017-03-22 11:02:01 - x86/mm: use statically defined locking order
backport-5823d6eb40af.patch #   2017-03-24 12:23:47 - tools/libxenforeignmemory: add a call to restrict the handle
backport-9a7fbdd6925b.patch #   2017-03-27 12:36:01 - tools/libxenforeignmemory: bind restrict operation to new version
backport-4c8153d97efe.patch #   2017-03-28 09:42:26 - tools/firmware: add ACPI device for Windows laptop/slate mode switch
backport-04f34e76ac50.patch #   2017-04-06 10:37:32 - tools/python: Adjust migration v2 library to warn about zero-content records
backport-8198ff2cdfbc.patch #   2017-04-26 08:39:14 - hvm/dmop: box dmop_args rather than passing multiple parameters around
backport-60f07f8adb5d.patch #   2017-04-26 08:40:00 - hvm/dmop: make copy_buf_{from, to}_guest for a buffer not big enough an error
backport-a9404c0e5305.patch #   2017-04-26 08:42:47 - hvm/dmop: implement COPY_{TO,FROM}_GUEST_BUF() in terms of raw accessors
backport-a579c8bcf348.patch #   2017-04-26 08:46:57 - hvm/dmop: implement COPY_{TO,FROM}_GUEST_BUF_OFFSET() helpers
backport-e3b93b3c5954.patch #   2017-04-26 08:47:30 - dmop: add xendevicemodel_modified_memory_bulk()
backport-c5f640ea6046.patch #   2017-05-04 16:00:46 - libs/devicemodel: Fix dependency with libxencall
backport-1366a0e76db6.patch #   2017-05-08 13:52:31 - x86/vm_event: add hvm/vm_event.{h,c}
backport-461f0482033b.patch #   2017-05-08 13:54:00 - x86/vm_event: fix race between __context_switch() and vm_event_resume()
backport-1c5e242e6d6e.patch #   2017-05-08 13:55:20 - x86: correct create_bounce_frame
backport-0d1a96043a75.patch #   2017-05-10 14:45:39 - libxenforeignmemory: bump minor version number
backport-7cc806d7f1d9.patch #   2017-05-24 17:15:34 - Restore HVM_OP hypercall continuation (partial revert of ae20ccf)
backport-d9eb706356ad.patch #   2017-05-25 09:59:49 - x86/hvmloader: Don't wait for the producer to fill the ring if
backport-20f1976b4419.patch #   2017-06-07 12:00:41 - x86/vmx: Fix vmentry failure because of invalid LER on Broadwell
backport-90288044a67a.patch #   2017-06-09 13:11:37 - kexec: provide user friendly option for memory limit
backport-4c09689153c3.patch #   2017-06-20 16:13:02 - rombios/ata: wait for BSY to clear after write
backport-6b792e28bca8.patch #   2017-06-30 11:27:51 - vvmx: fix ept_sync() for nested p2m
backport-143e0c2c2d64.patch #   2017-06-30 15:27:05 - tools/libxenforeignmemory: add xenforeignmemory_map2 function
backport-68209ad1d2a7.patch #   2017-07-27 11:39:57 - x86/vmx: Improvements to vmx_{dis,en}able_intercept_for_msr()
backport-82942526572c.patch #   2017-07-27 11:39:57 - x86/vpmu: Use vmx_{clear,set}_msr_intercept() rather than opencoding them
backport-62999081ca27.patch #   2017-07-27 11:39:57 - x86/vmx: Introduce and use struct vmx_msr_bitmap
backport-4da2fe19232e.patch #   2017-07-27 11:39:57 - x86/vvmx: Switch nested MSR intercept handling to use struct vmx_msr_bitmap
backport-930f7879248e.patch #   2017-07-27 11:39:57 - x86/vvmx: Fix handing of the MSR_BITMAP field with VMCS shadowing
backport-f0f1a778d4d5.patch #   2017-07-27 11:39:57 - x86/vvmx: Fix auditing of MSR_BITMAP parameter
backport-806e07eecfe3.patch #   2017-08-09 11:23:16 - common/page_alloc: Drop BOOT_BUG_ON()
backport-7c275549f46c.patch #   2017-08-10 11:34:21 - AMD IOMMU: drop amd_iommu_setup_hwdom_device()
backport-cd3ed39b9df0.patch #   2017-08-21 14:49:36 - hvmloader: support system enclosure asset tag (SMBIOS type 3)
backport-69d99d1b223f.patch #   2017-08-30 11:02:24 - x86/pt: add a MSI unmask flag to XEN_DOMCTL_bind_pt_irq
backport-9e50d8adc945.patch #   2017-09-01 11:03:20 - hvmloader, libxl: use the correct ACPI settings depending on device model
backport-eb4e638a4747.patch #   2017-09-05 16:32:43 - x86emul: correct EVEX decoding
backport-c0bac61bb422.patch #   2017-09-18 11:25:32 - VMX: convert CPU family numbers to hex
backport-9d6803250243.patch #   2017-09-18 11:26:22 - VMX: add new CPU families to LBR handling
backport-41d1fcb1c9bf.patch #   2017-09-20 16:17:21 - x86/vvmx: add hvm_intsrc_vector support to nvmx_intr_intercept()
backport-4098b092e190.patch #   2017-09-25 09:53:00 - x86/msr: introduce struct msr_domain_policy
backport-4187f79dc718.patch #   2017-09-25 09:54:09 - x86/msr: introduce struct msr_vcpu_policy
backport-e7a370733bd2.patch #   2017-09-25 09:55:23 - x86: replace arch_vcpu::cpuid_faulting with msr_vcpu_policy
backport-37f074a33831.patch #   2017-09-25 09:56:13 - x86/msr: introduce guest_rdmsr()
backport-664adc5ccab1.patch #   2017-09-25 09:56:52 - x86/msr: introduce guest_wrmsr()
backport-d73e68c08f1f.patch #   2017-09-26 10:33:35 - x86/levelling: Avoid NULL pointer dereference
backport-f99b7b06378d.patch #   2017-09-26 11:10:08 - Tidy libxc xc_domain_save
backport-4d69b3495986.patch #   2017-09-26 11:10:08 - Introduce migration precopy policy
backport-1c2ea5ee05f6.patch #   2017-09-28 11:57:21 - x86/hvm/dmop: fix EFAULT condition
backport-71b7b4e0f5f9.patch #   2017-09-28 11:57:45 - libxendevicemodel: initialise extent.pad to zero
backport-a08a9cd3afa6.patch #   2017-10-06 13:36:43 - x86/np2m: refactor p2m_get_nestedp2m()
backport-77690ea09ab2.patch #   2017-10-06 13:36:43 - x86/np2m: flush all np2m objects on nested INVEPT
backport-cd579578aac4.patch #   2017-10-06 13:36:43 - x86/np2m: remove np2m_base from p2m_get_nestedp2m()
backport-ec832dddc4c5.patch #   2017-10-06 13:36:43 - x86/np2m: simplify nestedhvm_hap_nested_page_fault()
backport-7b6546e83147.patch #   2017-10-06 13:36:43 - x86/vvmx: make updating shadow EPTP value more efficient
backport-a65a24209cd8.patch #   2017-10-06 13:36:43 - x86/np2m: send flush IPIs only when a vcpu is actively using an np2m
backport-6df4b481b0c5.patch #   2017-10-06 13:36:43 - x86/np2m: implement sharing of np2m between vCPUs
backport-cf23c69fdd48.patch #   2017-10-06 13:36:43 - x86/np2m: refactor p2m_get_nestedp2m_locked()
backport-23044a4e00c1.patch #   2017-10-06 13:36:43 - x86/np2m: add break to np2m_flush_eptp()
backport-9c23ed56d797.patch #   2017-10-11 12:51:22 - xen: Provide XEN_DMOP_remote_shutdown
backport-e1ab1c03ad6a.patch #   2017-10-11 12:51:22 - xen: x86 dm_op: add missing newline before XEN_DMOP_inject_msi
backport-1462f9ea8f42.patch #   2017-10-11 12:51:22 - tools: libxendevicemodel: Provide xendevicemodel_shutdown
backport-b08da5859b72.patch #   2017-10-11 12:51:22 - xentoolcore, _restrict_all: Introduce new library and implementation
backport-11dd1f6e2da5.patch #   2017-10-11 12:51:22 - tools: move CONTAINER_OF to xentoolcore_internal.h
backport-622620792431.patch #   2017-10-11 12:51:22 - xentoolcore_restrict_all: Implement for libxendevicemodel
backport-8d201cae61db.patch #   2017-10-11 12:51:22 - xentoolcore_restrict_all: "Implement" for libxencall
backport-f5a246e1c219.patch #   2017-10-11 12:51:22 - xentoolcore_restrict: Break out xentoolcore__restrict_by_dup2_null
backport-7e781bdeaeb4.patch #   2017-10-11 12:51:22 - xentoolcore_restrict_all: Implement for libxenforeignmemory
backport-83b191eaa194.patch #   2017-10-11 12:51:22 - xentoolcore_restrict_all: Declare problems due to no evtchn support
backport-c688dceca59f.patch #   2017-10-11 12:51:22 - xentoolcore_restrict_all: "Implement" for xengnttab
backport-0e318c7b354d.patch #   2017-10-11 12:51:22 - tools/xenstore: get_handle: use "goto err" error handling style
backport-edf4af67047c.patch #   2017-10-11 12:51:22 - tools/xenstore: get_handle: Allocate struct before opening fd
backport-f942a9b4a120.patch #   2017-10-11 12:51:22 - xentoolcore_restrict_all: "Implement" for xenstore
backport-f37c2aa32347.patch #   2017-10-11 12:51:22 - xentoolcore, _restrict_all: Document implementation "complete"
backport-52dd77ed9361.patch #   2017-10-11 12:51:22 - tools: xentoolcore_restrict_all: use domid_t
backport-56a53ee1c11b.patch #   2017-10-11 16:49:48 - x86: fix XEN_DMOP_remote_shutdown return value
backport-4ed00f57f086.patch #   2017-10-18 10:54:23 - tools: libxendevicemodel: Restore symbol versions for 1.0
backport-6b6500b3cbaa.patch #   2017-10-27 15:06:39 - tools/libs/evtchn: Add support for restricting a handle
backport-89d55473ed16.patch #   2017-10-27 15:06:50 - xentoolcore_restrict_all: Implement for libxenevtchn
backport-3b2966e72c41.patch #   2017-11-09 17:02:25 - libevtchn: fix build on non-Linux hosts
backport-0de212b03066.patch #   2017-11-14 13:54:29 - libs/evtchn: Remove active handler on clean-up or failure
backport-9976f3874d4c.patch #   2017-11-28 18:10:16 - tools: xentoolcore_restrict_all: Do deregistration before close
backport-b90f86be161c.patch #   2017-12-01 18:09:48 - x86: Avoid corruption on migrate for vcpus using CPUID Faulting
backport-f97f774b5aa6.patch #   2018-01-24 17:01:00 - x86/shutdown: use ACPI reboot method for Dell PowerEdge R740
backport-2375832c7e51.patch #   2018-01-25 10:35:20 - xen/VT-d: Remove the use of __LINE__ from IOMMU_WAIT_OP()
backport-34ae3fce896c.patch #   2018-01-25 11:23:35 - mm: make xenmem_add_to_physmap global
backport-6606cf3e2af0.patch #   2018-01-25 11:24:14 - x86/hvm: provide XEN_DMOP_relocate_memory
backport-642123c5123f.patch #   2018-01-25 11:25:22 - x86/hvm: provide XEN_DMOP_pin_memory_cacheattr
backport-704538a47411.patch #   2018-01-25 11:26:23 - libxendevicemodel: provide xendevicemodel_relocate_memory
backport-af2a20e40e92.patch #   2018-01-25 11:26:36 - libxendevicemodel: provide xendevicemodel_pin_memory_cacheattr
backport-7f76b3a06aef.patch #   2018-01-25 11:26:55 - x86/domctl: remove XEN_DOMCTL_pin_mem_cacheattr
backport-85cb15dfe4d1.patch #   2018-02-15 17:16:17 - x86/hvm/dmop: only copy what is needed to/from the guest
backport-328ca55b7bd4.patch #   2018-06-28 08:29:13 - x86/shutdown: use ACPI reboot method for Dell PowerEdge R540
backport-f30e3cf34042.patch #   2018-06-28 11:31:26 - x86/vmx: Defer vmx_vmcs_exit() as long as possible in construct_vmcs()
backport-730dc8d2c9e1.patch #   2018-07-04 12:12:14 - x86/vmx: Fix handing of MSR_DEBUGCTL on VMExit
backport-f54b63e8617a.patch #   2018-07-04 12:12:14 - x86/vmx: API improvements for MSR load/save infrastructure
backport-94fda356fcdc.patch #   2018-07-04 12:12:14 - x86/vmx: Internal cleanup for MSR load/save infrastructure
backport-4d94828cf111.patch #   2018-07-04 12:12:15 - x86/vmx: Factor locate_msr_entry() out of vmx_find_msr() and vmx_add_msr()
backport-80599f0b7701.patch #   2018-07-04 12:12:15 - x86/vmx: Support remote access to the MSR lists
backport-be73a842e642.patch #   2018-07-04 12:12:15 - x86/vmx: Improvements to LBR MSR handling
backport-ee7689b94ac7.patch #   2018-07-04 12:12:15 - x86/vmx: Pass an MSR value into vmx_msr_add()
backport-1ac46b556326.patch #   2018-07-04 12:12:15 - x86/vmx: Support load-only guest MSR list entries

xsa269-4.8.patch  # x86/vtx: Fix the checking for unknown/invalid MSR_DEBUGCTL bits
xsa272.patch # tools/oxenstored: Make evaluation order explicit

# XSA-273
0001-x86-spec-ctrl-Yet-more-fixes-for-xpti-parsing.patch
0002-x86-spec-ctrl-Calculate-safe-PTE-addresses-for-L1TF-.patch
0003-x86-spec-ctrl-Introduce-an-option-to-control-L1TF-mi.patch
0004-x86-shadow-Infrastructure-to-force-a-PV-guest-into-s.patch
0005-x86-mm-Plumbing-to-allow-any-PTE-update-to-fail-with.patch
0006-x86-pv-Force-a-guest-into-shadow-mode-when-it-writes.patch
0007-x86-spec-ctrl-CPUID-MSR-definitions-for-L1D_FLUSH.patch
0008-x86-msr-Virtualise-MSR_FLUSH_CMD-for-guests.patch
0009-x86-spec-ctrl-Introduce-an-option-to-control-L1D_FLU.patch
0010-x86-shadow-dom0-force-shadow-for-debugging-purposes.patch

################################################################################
# Patches for upstream
#

detect-nehalem-c-state.patch # malcolmc
quirk-hp-gen8-rmrr.patch # malcolmc
quirk-pci-phantom-function-devices.patch # malcolmc
sched-credit1-use-per-pcpu-runqueue-count.patch # malcolmc

# Hpet improvements v5
0001-x86-hpet-Pre-cleanup.patch
0002-x86-hpet-Use-singe-apic-vector-rather-than-irq_descs.patch
0003-x86-hpet-Post-cleanup.patch

0002-libxc-retry-shadow-ops-if-EBUSY-is-returned.patch

# Grant perf improvements
avoid-gnt-unmap-tlb-flush-if-not-accessed.patch

# Multiboot2 + EFI (from Daniel Kiper)
0002-x86-boot-reloc-create-generic-alloc-and-copy-functio.patch
0003-x86-boot-use-ecx-instead-of-eax.patch
0004-xen-x86-add-multiboot2-protocol-support.patch
0005-efi-split-efi_enabled-to-efi_platform-and-efi_loader.patch
0007-efi-run-EFI-specific-code-on-EFI-platform-only.patch
0008-efi-build-xen.gz-with-EFI-code.patch
0017-x86-efi-create-new-early-memory-allocator.patch
0018-x86-add-multiboot2-protocol-support-for-EFI-platform.patch
mkelf32-fixup.patch
0001-x86-efi-Find-memory-for-trampoline-relocation-if-nec.patch
0002-efi-Ensure-incorrectly-typed-runtime-services-get-ma.patch
0001-Fix-compilation-on-CentOS-7.1.patch
0001-x86-time-Don-t-use-EFI-s-GetTime-call.patch
0001-efi-Workaround-page-fault-during-runtime-service.patch
efi-align-stack.patch

0001-x86-HVM-Avoid-cache-flush-operations-during-hvm_load.patch # rossla - CA-168080
0001-libxl-Don-t-insert-PCI-device-into-xenstore-for-HVM-.patch # rossla - CA-168029

# PoD extra mitigations
0001-x86-PoD-Command-line-option-to-prohibit-any-PoD-oper.patch

0001-libxl-handle-an-INVALID-domain-when-removing-a-pci-d.patch

fail-on-duplicate-symbol.patch
livepatch-ignore-duplicate-new.patch
default-log-level-info.patch

# Hook functions for livepatch
livepach-Add-.livepatch.hooks-functions-and-test-cas.patch

# Reduce use of __LINE__
0001-lib-Add-a-generic-implementation-of-current_text_add.patch
0002-sched-Remove-dependency-on-__LINE__-for-release-buil.patch

# xen-livepatch tool improvements
0001-tools-livepatch-Show-the-correct-expected-state-befo.patch
0002-tools-livepatch-Set-stdout-and-stderr-unbuffered.patch
0003-tools-livepatch-Improve-output.patch
0004-livepatch-Set-timeout-unit-to-nanoseconds.patch
0005-tools-livepatch-Remove-pointless-retry-loop.patch
0006-tools-livepatch-Remove-unused-struct-member.patch
0007-tools-livepatch-Exit-with-2-if-a-timeout-occurs.patch

# btrfs support for PV guests
pygrub-Ignore-GRUB2-if-statements.patch
libfsimage-Add-support-for-btrfs.patch

0001-xen-domctl-Implement-a-way-to-retrieve-a-domains-nom.patch

quiet-broke-irq-affinity.patch # rossla

quirk-intel-purley.patch # rossla

xsa226-cmdline-options.patch

# gcov updates from:
#   git://xenbits.xen.org/people/liuw/xen.git wip.rework-gcov-v5
0001-Kconfig-add-BROKEN-config.patch
0002-xen-delete-gcno-files-in-clean-target.patch
0003-xen-tools-rip-out-old-gcov-implementation.patch
0004-gcov-add-new-interface-and-new-formats-support.patch
0005-gcov-userspace-tools-to-extract-and-split-gcov-data.patch
0006-Config.mk-expand-cc-ver-a-bit.patch
0007-Config.mk-introduce-cc-ifversion.patch
0008-gcov-provide-the-capability-to-select-gcov-format-au.patch
0009-flask-add-gcov_op-check.patch

# nested virt
0001-x86-vvmx-set-CR4-before-CR0.patch

# MSR policy
0001-x86-msr-Blacklist-various-MSRs-which-guests-definite.patch

# AVX-512
0004-x86-cpuid-Enable-new-SSE-AVX-AVX512-cpu-features.patch
0001-Hide-AVX-512-from-guests-by-default.patch

# xsm SILO
0001-xen-xsm-Rename-CONFIG_FLASK_-to-CONFIG_XSM_FLASK_.patch
0002-xen-xsm-Rename-CONIFIG_XSM_POLICY-to-CONFIG_XSM_FLAS.patch
0003-xen-xsm-Introduce-new-boot-parameter-xsm.patch
0004-xen-xsm-Add-new-SILO-mode-for-XSM.patch

################################################################################
# Un-upstreamable patches
#
xen-tweak-cmdline-defaults.patch
xen-tweak-debug-overhead.patch
tweak-iommu-errata-policy.patch
disable-core-parking.patch
disable-runtime-microcode.patch

0001-firmware-hvmloader-save-final-MMIO-hole-size-for-the.patch

# Un-upstreamable hacks to make older windows VMs continue to function on newer Xen
xen-legacy-win-driver-version.patch
xen-legacy-win-xenmapspace-quirks.patch
xen-legacy-32bit_shinfo.patch
xen-legacy-process-dying.patch
xen-legacy-viridian-hypercalls.patch
xen-legacy-hvm-console.patch

################################################################################
# Technical debt
#

# xen debt
livepatch-payload-in-header.patch
xen-define-offsets-for-kdump.patch
xen-scheduler-auto-privdom-weight.patch
xen-hvm-disable-tsc-ramping.patch
xen-default-cpufreq-governor-to-performance-on-intel.patch
xen-override-caching-cp-26562.patch

# libxc debt
revert-ca2eee92df44.patch # 2008-09-30 09:14:54 - x86, hvm: Expose host core/HT topology to HVM guests - needs removing in a migrate-safe way.
libxc-stubs-hvm_check_pvdriver.patch
restrict-privcmd.patch

# pygrub debt
pygrub-add-default-and-extra-args.patch
pygrub-always-boot-default.patch
pygrub-friendly-no-fs.patch
pygrub-image-max-size.patch
pygrub-default-xenmobile-kernel.patch
pygrub-blacklist-support.patch

# BIOS debt
oem-bios-xensource.patch # Can probably all be discarded
oem-bios-magic-from-xenstore.patch # Need to tweak, but should be upstreamed

# misc debt
misc-log-guest-consoles.patch
fix-ocaml-libs.patch
ocaml-cpuid-helpers.patch

# xentop debt
xentop-display-correct-stats.patch
xentop-vbd3.patch

# mixed between components
mixed-domain-runstates.patch
mixed-xc-sockets-per-core.patch
xenguest.patch
xen-vmdebug.patch
local-xen-vmdebug.patch

oxenstore-update.patch
oxenstore-censor-sensitive-data.patch
oxenstore-large-packets.patch

# vGPU
nvidia-vga.patch

# workspace pod debt
hvmloader-disable-pci-option-rom-loading.patch

# Nested virt tweaking knobs
xen-force-software-vmcs-shadow.patch
0001-x86-vvmx-add-initial-PV-EPT-support-in-L0.patch

add-p2m-write-dm-to-ram-types.patch
add-pv-iommu-headers.patch
add-iommu-lookup-core.patch
add-iommu-lookup-intel.patch
add-pv-iommu-local-domain-ops.patch
add-pv-iommu-foreign-support.patch
add-pv-iommu-premap-m2b-support.patch
add-pv-iommu-to-spec.patch
upstream-pv-iommu-tools.patch

# Intel GVT-g debt
allow-rombios-pci-config-on-any-host-bridge.patch
0007-hypercall-XENMEM_get_mfn_from_pfn.patch # Remove when PV-IOMMU code merged
0012-resize-MAX_NR_IO_RANGES-to-512.patch # Replace with list discussed version when merged
0015-xen-introduce-unlimited-rangeset.patch # Replace with list discussed version when merged
0016-ioreq-server-allocate-unlimited-rangeset-for-memory-.patch # Replace with list discussed version when merged
gvt-g-hvmloader+rombios.patch # Intel to upstream
revert-c858e932c1dd.patch # Reinstate HVMMEM_mmio_write_dm

# VM Introspection Extensions
xen-introduce-cmdline-to-control-introspection-extensions.patch
xen-domctl-set-privileged-domain.patch
xen-x86-hvm-Allow-guest_request-vm_events-coming-from-us.patch
x86-domctl-Don-t-pause-the-whole-domain-if-only-gett.patch
xen-reexecute-instn-under-monitor-trap.patch
xen-x86-emulate-syncrhonise-LOCKed-instruction-emulation.patch
xen-emulate-Bypass-the-emulator-if-emulation-fails.patch
xen-introspection-pause.patch
xen-introspection-elide-cr4-pge.patch

# XSM
xen-xsm-default-policy.patch
xen-xsm-allow-access-unlabeled-resources.patch
xen-xsm-treat-unlabeled-domain-domU.patch

# Common Criteria
0001-cc-memory-scrubbing.patch

################################################################################
# Hotfix patches
#
xsa278-4.7.patch # x86/vvmx: Disallow the use of VT-x instructions when nested virt is disabled

xsa275-4.7-1.patch # amd/iommu: fix flush checks
xsa275-4.7-2.patch # AMD/IOMMU: suppress PTE merging after initial table creation
xsa279-4.9.patch # x86/mm: Don't perform flush after failing to update a guests L1e
xsa280-4.9-1.patch # x86/shadow: move OOS flag bit positions
xsa280-4.7-2.patch # x86/shadow: shrink struct page_info's shadow_flags to 16 bits
xsa282-4.9-1.patch # x86: extend get_platform_badpages() interface
xsa282-4.8-2.patch # x86: work around HLE host lockup erratum

0001-VMX-allow-migration-of-guests-with-SSBD-enabled.patch
xsa283.patch # IOMMU/VT-d: Correct the calculation of which IRTE to use
xsa284.patch # gnttab: set page refcount for copy-on-grant-transfer
xsa285-4.11.patch # IOMMU/x86: fix type ref-counting race upon IOMMU page table construction
xsa287-4.7.patch # steal_page: Get rid of bogus struct page states
xsa288-4.7.patch # xen: Make coherent PV IOMMU discipline
xsa290-4.7-1.patch # x86/mm: also allow L2 (un)validation to be preemptible
xsa290-4.7-2.patch # x86/mm: add explicit preemption checks to L3 (un)validation
xsa292.patch # x86/mm: properly flush TLB in switch_cr3_cr4()
xsa293-4.7-1.patch # x86/pv: Improve pv_cpuid()'s API
xsa293-4.7-2.patch # x86/pv: Rewrite guest %cr4 handling from scratch
xsa293-4.7-3.patch # x86/pv: Don't have %cr4.fsgsbase active behind a guest kernels back
xsa294-4.7.patch # x86/pv: _toggle_guest_pt() may not skip TLB flush for shadow mode guests

backport-ff9b9d540f1b.patch #   2019-01-21 11:13:22 - x86/vm_event: block interrupt injection for sync vm_events
backport-fc46e159a6b1.patch #   2019-03-18 16:08:25 - x86/tsx: Implement controls for RTM force-abort mode
backport-ffb60a58df48.patch #   2018-11-01 10:20:34 - tools/misc/xenpm: fix getting info when some CPUs are offline
# HT boot-time detection
0001-x86-spec-ctrl-Reposition-the-XPTI-command-line-parsi.patch
0002-x86-msr-Definitions-for-MSR_INTEL_CORE_THREAD_COUNT.patch
0003-x86-boot-Detect-the-firmware-SMT-setting-correctly-o.patch
xsa297-4.7-1.patch
xsa297-4.7-2.patch
xsa297-4.7-3.patch
xsa297-4.7-4.patch
# vCPU migration race mitigation
0001-xen-Introduce-vcpu_sleep_nosync_locked.patch
0002-xen-schedule-Fix-races-in-vcpu-migration.patch

backport-56ad626532eb.patch #   2019-07-02 12:00:42 - x86/msi: fix loop termination condition in pci_msi_conf_write_intercept()
backport-63d71138a4d3.patch #   2019-02-01 10:31:28 - x86/VT-x: Don't activate VMCS Shadowing outside of nested vmx mode
0001-IOMMU-add-missing-HVM-check.patch
0002-passthrough-quarantine-PCI-devices.patch
xsa296-4.8.patch
xsa298-4.9.patch
xsa299-4.80001-x86-mm-Clean-up-trailing-whitespace.patch
xsa299-4.80002-x86-mm-L1TF-checks-don-t-leave-a-partial-entry.patch
xsa299-4.80003-x86-mm-Don-t-re-set-PGT_pinned-on-a-partially-de-val.patch
xsa299-4.80004-x86-mm-Separate-out-partial_pte-tristate-into-indivi.patch
xsa299-4.80005-x86-mm-Use-flags-for-_put_page_type-rather-than-a-bo.patch
xsa299-4.80006-x86-mm-Rework-get_page_and_type_from_mfn-conditional.patch
xsa299-4.80007-x86-mm-Have-alloc_l-23-_table-clear-partial_flags-wh.patch
xsa299-4.80008-x86-mm-Always-retain-a-general-ref-on-partial.patch
xsa299-4.80009-x86-mm-Collapse-PTF_partial_set-and-PTF_partial_gene.patch
xsa299-4.80010-x86-mm-Properly-handle-linear-pagetable-promotion-fa.patch
xsa299-4.80011-x86-mm-Fix-nested-de-validation-on-error.patch
xsa299-4.80012-x86-mm-Don-t-drop-a-type-ref-unless-you-held-a-ref-t.patch
backport-b68c4f1ebe4f.patch #   2018-02-28 17:56:24 - x86/hvm: fix domain crash when CR3 has the noflush bit set
backport-b144cf45d50b.patch #   2019-05-31 10:40:52 - x86/vhpet: avoid 'small' time diff test on resume
xsa304-4.7-1.patch # x86/vtd: Hide superpage support for SandyBridge IOMMUs
xsa304-4.7-2.patch # x86/vtx: Disable executable EPT superpages to work around CVE-2018-12207
xsa304-fast-by-default.patch
xsa305-4.7-1.patch # x86/tsx: Introduce tsx= to use MSR_TSX_CTRL when available
xsa305-4.7-2.patch # x86/spec-ctrl: Mitigate the TSX Asynchronous Abort sidechannel
toolstack-tsx-ctrl.patch
xsa305-leave-tsx-visible.patch
xsa308.patch
xsa309.patch
xsa310-4.9-0001-x86-mm-Set-old_guest_table-when-destroying-vcpu-page.patch
xsa310-4.9-0002-x86-mm-alloc-free_lN_table-Retain-partial_flags-on-E.patch
xsa310-4.9-0003-x86-mm-relinquish_memory-Grab-an-extra-type-ref-when.patch
